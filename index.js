var Decoration=class{constructor(a,b){this.target=a,this.options=b}};function decorate(a,b){return new Decoration(a,b)}var MultiReturn=class extends Array{},Pointer=class extends Number{};let LuaReturn=function(a){return a[a.Ok=0]="Ok",a[a.Yield=1]="Yield",a[a.ErrorRun=2]="ErrorRun",a[a.ErrorSyntax=3]="ErrorSyntax",a[a.ErrorMem=4]="ErrorMem",a[a.ErrorErr=5]="ErrorErr",a[a.ErrorFile=6]="ErrorFile",a}({});const PointerSize=4,LUA_MULTRET=-1,LUAI_MAXSTACK=1e6,LUA_REGISTRYINDEX=-LUAI_MAXSTACK-1e3;let LuaType=function(a){return a[a.None=-1]="None",a[a.Nil=0]="Nil",a[a.Boolean=1]="Boolean",a[a.LightUserdata=2]="LightUserdata",a[a.Number=3]="Number",a[a.String=4]="String",a[a.Table=5]="Table",a[a.Function=6]="Function",a[a.Userdata=7]="Userdata",a[a.Thread=8]="Thread",a}({}),LuaEventCodes=function(a){return a[a.Call=0]="Call",a[a.Ret=1]="Ret",a[a.Line=2]="Line",a[a.Count=3]="Count",a[a.TailCall=4]="TailCall",a}({}),LuaEventMasks=function(a){return a[a.Call=1]="Call",a[a.Ret=2]="Ret",a[a.Line=4]="Line",a[a.Count=8]="Count",a}({}),LuaLibraries=function(a){return a.Base="_G",a.Coroutine="coroutine",a.Table="table",a.IO="io",a.OS="os",a.String="string",a.UTF8="utf8",a.Math="math",a.Debug="debug",a.Package="package",a}({});var LuaTimeoutError=class extends Error{};const INSTRUCTION_HOOK_COUNT=1e3;var Thread=class a{address;lua;typeExtensions;closed=!1;hookFunctionPointer;timeout;parent;constructor(b,c,d,e){this.lua=b,this.typeExtensions=c,this.address=d,this.parent=e}newThread(){const b=this.lua.lua_newthread(this.address);if(!b)throw Error("lua_newthread returned a null pointer");return new a(this.lua,this.typeExtensions,b,this.parent||this)}resetThread(){this.assertOk(this.lua.lua_resetthread(this.address))}loadString(b,c){const d=this.lua.module.lengthBytesUTF8(b),e=d+1,f=this.lua.module._malloc(e);try{this.lua.module.stringToUTF8(b,f,e),this.assertOk(this.lua.luaL_loadbufferx(this.address,f,d,c??f,null))}finally{this.lua.module._free(f)}}loadFile(b){this.assertOk(this.lua.luaL_loadfilex(this.address,b,null))}resume(b=0){const c=this.lua.module._malloc(PointerSize);try{this.lua.module.setValue(c,0,"i32");const d=this.lua.lua_resume(this.address,null,b,c);return{result:d,resultCount:this.lua.module.getValue(c,"i32")}}finally{this.lua.module._free(c)}}getTop(){return this.lua.lua_gettop(this.address)}setTop(b){this.lua.lua_settop(this.address,b)}remove(b){return this.lua.lua_remove(this.address,b)}setField(b,c,d){b=this.lua.lua_absindex(this.address,b),this.pushValue(d),this.lua.lua_setfield(this.address,b,c)}async run(b=0,c){const d=this.timeout;try{c?.timeout!==void 0&&this.setTimeout(Date.now()+c.timeout);let e=this.resume(b);for(;e.result===LuaReturn.Yield;){if(this.timeout&&Date.now()>this.timeout)throw e.resultCount>0&&this.pop(e.resultCount),new LuaTimeoutError("thread timeout exceeded");if(e.resultCount>0){const f=this.getValue(-1);this.pop(e.resultCount),f===Promise.resolve(f)?await f:await new Promise(g=>setImmediate(g))}else await new Promise(f=>setImmediate(f));e=this.resume(0)}return this.assertOk(e.result),this.getStackValues()}finally{c?.timeout!==void 0&&this.setTimeout(d)}}runSync(b=0){const c=this.getTop()-b-1;return this.assertOk(this.lua.lua_pcallk(this.address,b,LUA_MULTRET,0,0,null)),this.getStackValues(c)}pop(b=1){this.lua.lua_pop(this.address,b)}call(b,...c){const d=this.lua.lua_getglobal(this.address,b);if(d!==LuaType.Function)throw Error(`A function of type '${d}' was pushed, expected is ${LuaType.Function}`);for(const f of c)this.pushValue(f);const e=this.getTop()-c.length-1;return this.lua.lua_callk(this.address,c.length,LUA_MULTRET,0,null),this.getStackValues(e)}getStackValues(b=0){const c=this.getTop()-b,d=new MultiReturn(c);for(let e=0;e<c;e++)d[e]=this.getValue(b+e+1);return d}stateToThread(b){return b===this.parent?.address?this.parent:new a(this.lua,this.typeExtensions,b,this.parent||this)}pushValue(b,c){const d=this.getValueDecorations(b),e=d.target;if(e instanceof a){const g=this.lua.lua_pushthread(e.address)===1;g||this.lua.lua_xmove(e.address,this.address,1);return}const f=this.getTop();switch(typeof e){case"undefined":this.lua.lua_pushnil(this.address);break;case"number":Number.isInteger(e)?this.lua.lua_pushinteger(this.address,BigInt(e)):this.lua.lua_pushnumber(this.address,e);break;case"string":this.lua.lua_pushstring(this.address,e);break;case"boolean":this.lua.lua_pushboolean(this.address,e?1:0);break;default:if(this.typeExtensions.find(g=>g.extension.pushValue(this,d,c)))break;if(e===null){this.lua.lua_pushnil(this.address);break}throw Error(`The type '${typeof e}' is not supported by Lua`)}if(d.options.metatable&&this.setMetatable(-1,d.options.metatable),this.getTop()!==f+1)throw Error(`pushValue expected stack size ${f+1}, got ${this.getTop()}`)}setMetatable(b,c){if(b=this.lua.lua_absindex(this.address,b),this.lua.lua_getmetatable(this.address,b)){this.pop(1);const d=this.getMetatableName(b);throw Error(`data already has associated metatable: ${d||"unknown name"}`)}this.pushValue(c),this.lua.lua_setmetatable(this.address,b)}getMetatableName(b){const c=this.lua.luaL_getmetafield(this.address,b,"__name");if(c===LuaType.Nil)return;if(c!==LuaType.String){this.pop(1);return}const d=this.lua.lua_tolstring(this.address,-1,null);return this.pop(1),d}getValue(b,c,d){b=this.lua.lua_absindex(this.address,b);const e=c??this.lua.lua_type(this.address,b);switch(e){case LuaType.None:return;case LuaType.Nil:return null;case LuaType.Number:return this.lua.lua_tonumberx(this.address,b,null);case LuaType.String:return this.lua.lua_tolstring(this.address,b,null);case LuaType.Boolean:return!!this.lua.lua_toboolean(this.address,b);case LuaType.Thread:return this.stateToThread(this.lua.lua_tothread(this.address,b));default:{let f;(e===LuaType.Table||e===LuaType.Userdata)&&(f=this.getMetatableName(b));const g=this.typeExtensions.find(h=>h.extension.isType(this,b,e,f));return g?g.extension.getValue(this,b,d):(console.warn(`The type '${this.lua.lua_typename(this.address,e)}' returned is not supported on JS`),new Pointer(this.lua.lua_topointer(this.address,b)))}}}close(){if(this.isClosed())return;this.hookFunctionPointer&&this.lua.module.removeFunction(this.hookFunctionPointer),this.closed=!0}setTimeout(b){b&&b>0?(this.hookFunctionPointer||(this.hookFunctionPointer=this.lua.module.addFunction(()=>{Date.now()>b&&(this.pushValue(new LuaTimeoutError("thread timeout exceeded")),this.lua.lua_error(this.address))},"vii")),this.lua.lua_sethook(this.address,this.hookFunctionPointer,LuaEventMasks.Count,INSTRUCTION_HOOK_COUNT),this.timeout=b):this.hookFunctionPointer&&(this.hookFunctionPointer=void 0,this.timeout=void 0,this.lua.lua_sethook(this.address,null,0,0))}getTimeout(){return this.timeout}getPointer(b){return new Pointer(this.lua.lua_topointer(this.address,b))}isClosed(){return!this.address||this.closed||!!this.parent?.isClosed()}indexToString(b){const c=this.lua.luaL_tolstring(this.address,b,null);return this.pop(),c}dumpStack(b=console.log){const c=this.getTop();for(let d=1;d<=c;d++){const e=this.lua.lua_type(this.address,d),f=this.lua.lua_typename(this.address,e),g=this.getPointer(d),h=this.indexToString(d),i=this.getValue(d,e);b(d,f,g,h,i)}}assertOk(b){if(b!==LuaReturn.Ok&&b!==LuaReturn.Yield){const c=LuaReturn[b],d=Error(`Lua Error(${c}/${b})`);if(this.getTop()>0)if(b===LuaReturn.ErrorMem)d.message=this.lua.lua_tolstring(this.address,-1,null);else{const e=this.getValue(-1);e instanceof Error&&(d.stack=e.stack),d.message=this.indexToString(-1)}if(b!==LuaReturn.ErrorMem)try{this.lua.luaL_traceback(this.address,this.address,null,1);const e=this.lua.lua_tolstring(this.address,-1,null);e.trim()!=="stack traceback:"&&(d.message=`${d.message}\n${e}`),this.pop(1)}catch(e){console.warn("Failed to generate stack trace",e)}throw d}}getValueDecorations(b){return b instanceof Decoration?b:new Decoration(b,{})}},Global=class extends Thread{memoryStats;allocatorFunctionPointer;constructor(a,b){if(b){const c={memoryUsed:0},d=a.module.addFunction((f,g,h,i)=>{if(i===0)return g&&(c.memoryUsed-=h,a.module._free(g)),0;const j=g?i-h:i,k=c.memoryUsed+j;if(i>h&&c.memoryMax&&k>c.memoryMax)return 0;const l=a.module._realloc(g,i);return l&&(c.memoryUsed=k),l},"iiiii"),e=a.lua_newstate(d,null);if(!e)throw a.module.removeFunction(d),Error("lua_newstate returned a null pointer");super(a,[],e),this.memoryStats=c,this.allocatorFunctionPointer=d}else super(a,[],a.luaL_newstate());if(this.isClosed())throw Error("Global state could not be created (probably due to lack of memory)")}close(){if(this.isClosed())return;super.close(),this.lua.lua_close(this.address),this.allocatorFunctionPointer&&this.lua.module.removeFunction(this.allocatorFunctionPointer);for(const a of this.typeExtensions)a.extension.close()}registerTypeExtension(a,b){this.typeExtensions.push({extension:b,priority:a}),this.typeExtensions.sort((c,d)=>d.priority-c.priority)}loadLibrary(a){switch(a){case LuaLibraries.Base:this.lua.luaopen_base(this.address);break;case LuaLibraries.Coroutine:this.lua.luaopen_coroutine(this.address);break;case LuaLibraries.Table:this.lua.luaopen_table(this.address);break;case LuaLibraries.IO:this.lua.luaopen_io(this.address);break;case LuaLibraries.OS:this.lua.luaopen_os(this.address);break;case LuaLibraries.String:this.lua.luaopen_string(this.address);break;case LuaLibraries.UTF8:this.lua.luaopen_utf8(this.address);break;case LuaLibraries.Math:this.lua.luaopen_math(this.address);break;case LuaLibraries.Debug:this.lua.luaopen_debug(this.address);break;case LuaLibraries.Package:this.lua.luaopen_package(this.address);break}this.lua.lua_setglobal(this.address,a)}get(a){const b=this.lua.lua_getglobal(this.address,a),c=this.getValue(-1,b);return this.pop(),c}set(a,b){this.pushValue(b),this.lua.lua_setglobal(this.address,a)}getTable(a,b){const c=this.getTop(),d=this.lua.lua_getglobal(this.address,a);try{if(d!==LuaType.Table)throw TypeError(`Unexpected type in ${a}. Expected ${LuaType[LuaType.Table]}. Got ${LuaType[d]}.`);b(c+1)}finally{this.getTop()!==c+1&&console.warn(`getTable: expected stack size ${c} got ${this.getTop()}`),this.setTop(c)}}getMemoryUsed(){return this.getMemoryStatsRef().memoryUsed}getMemoryMax(){return this.getMemoryStatsRef().memoryMax}setMemoryMax(a){this.getMemoryStatsRef().memoryMax=a}getMemoryStatsRef(){if(!this.memoryStats)throw Error("Memory allocations is not being traced, please build engine with { traceAllocations: true }");return this.memoryStats}},LuaTypeExtension=class{name;thread;constructor(a,b){this.thread=a,this.name=b}isType(a,b,c,d){return c===LuaType.Userdata&&d===this.name}getValue(a,b,c){const d=a.lua.luaL_testudata(a.address,b,this.name);if(!d)throw Error(`data does not have the expected metatable: ${this.name}`);const e=a.lua.module.getValue(d,"*");return a.lua.getRef(e)}pushValue(a,b,c){const{target:d}=b,e=a.lua.ref(d),f=a.lua.lua_newuserdatauv(a.address,PointerSize,0);if(a.lua.module.setValue(f,e,"*"),LuaType.Nil===a.lua.luaL_getmetatable(a.address,this.name))throw a.pop(2),Error(`metatable not found: ${this.name}`);return a.lua.lua_setmetatable(a.address,-2),!0}},ErrorTypeExtension=class extends LuaTypeExtension{gcPointer;constructor(a,b){if(super(a,"js_error"),this.gcPointer=a.lua.module.addFunction(c=>{const d=a.lua.luaL_checkudata(c,1,this.name),e=a.lua.module.getValue(d,"*");return a.lua.unref(e),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)){const c=a.lua.lua_gettop(a.address);a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_setfield(a.address,c,"__metatable"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_setfield(a.address,c,"__gc"),a.pushValue((d,e)=>e==="message"?d.message:null),a.lua.lua_setfield(a.address,c,"__index"),a.pushValue(d=>d.message),a.lua.lua_setfield(a.address,c,"__tostring")}a.lua.lua_pop(a.address,1),b&&a.set("Error",{create:c=>{if(c&&typeof c!="string")throw Error("message must be a string");return Error(c)}})}pushValue(a,b){return b.target instanceof Error?super.pushValue(a,b):!1}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function createTypeExtension$6(a,b){return new ErrorTypeExtension(a,b)}var RawResult=class{constructor(a){this.count=a}};function decorateFunction(a,b){return new Decoration(a,b)}var FunctionTypeExtension=class extends LuaTypeExtension{functionRegistry=typeof FinalizationRegistry<"u"?new FinalizationRegistry(a=>{this.thread.isClosed()||this.thread.lua.luaL_unref(this.thread.address,LUA_REGISTRYINDEX,a)}):void 0;gcPointer;functionWrapper;callbackContext;callbackContextIndex;options;constructor(a,b){super(a,"js_function"),this.options=b,this.callbackContext=a.newThread(),this.callbackContextIndex=this.thread.lua.luaL_ref(a.address,LUA_REGISTRYINDEX),this.functionRegistry||console.warn("FunctionTypeExtension: FinalizationRegistry not found. Memory leaks likely."),this.gcPointer=a.lua.module.addFunction(c=>{a.lua.luaL_checkudata(c,1,this.name);const d=a.lua.luaL_checkudata(c,1,this.name),e=a.lua.module.getValue(d,"*");return a.lua.unref(e),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)&&(a.lua.lua_pushstring(a.address,"__gc"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_settable(a.address,-3),a.lua.lua_pushstring(a.address,"__metatable"),a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_settable(a.address,-3)),a.lua.lua_pop(a.address,1),this.functionWrapper=a.lua.module.addFunction(c=>{const d=a.stateToThread(c),e=a.lua.luaL_checkudata(c,a.lua.lua_upvalueindex(1),this.name),f=a.lua.module.getValue(e,"*"),{target:g,options:h}=a.lua.getRef(f),i=d.getTop(),j=[];if(h.receiveThread&&j.push(d),h.receiveArgsQuantity)j.push(i);else for(let k=1;k<=i;k++){const l=d.getValue(k);(k!==1||!h?.self||l!==h.self)&&j.push(l)}try{const k=g.apply(h?.self,j);if(k===void 0)return 0;if(k instanceof RawResult)return k.count;if(k instanceof MultiReturn){for(const l of k)d.pushValue(l);return k.length}return d.pushValue(k),1}catch(k){if(k===1/0)throw k;return d.pushValue(k),d.lua.lua_error(d.address)}},"ii")}close(){this.thread.lua.module.removeFunction(this.gcPointer),this.thread.lua.module.removeFunction(this.functionWrapper),this.callbackContext.close(),this.callbackContext.lua.luaL_unref(this.callbackContext.address,LUA_REGISTRYINDEX,this.callbackContextIndex)}isType(a,b,c){return c===LuaType.Function}pushValue(a,b){if(typeof b.target!="function")return!1;const c=a.lua.ref(b),d=a.lua.lua_newuserdatauv(a.address,PointerSize,0);if(a.lua.module.setValue(d,c,"*"),LuaType.Nil===a.lua.luaL_getmetatable(a.address,this.name))throw a.pop(1),a.lua.unref(c),Error(`metatable not found: ${this.name}`);return a.lua.lua_setmetatable(a.address,-2),a.lua.lua_pushcclosure(a.address,this.functionWrapper,1),!0}getValue(a,b){a.lua.lua_pushvalue(a.address,b);const c=a.lua.luaL_ref(a.address,LUA_REGISTRYINDEX),d=(...e)=>{if(this.callbackContext.isClosed()){console.warn("Tried to call a function after closing lua state");return}const f=this.callbackContext.newThread();try{const g=f.lua.lua_rawgeti(f.address,LUA_REGISTRYINDEX,BigInt(c));if(g!==LuaType.Function){const i=f.lua.luaL_getmetafield(f.address,-1,"__call");if(f.pop(),i!==LuaType.Function)throw Error(`A value of type '${g}' was pushed but it is not callable`)}for(const i of e)f.pushValue(i);this.options?.functionTimeout&&f.setTimeout(Date.now()+this.options.functionTimeout);const h=f.lua.lua_pcallk(f.address,e.length,1,0,0,null);if(h===LuaReturn.Yield)throw Error("cannot yield in callbacks from javascript");if(f.assertOk(h),f.getTop()>0)return f.getValue(-1);return}finally{f.close(),this.callbackContext.pop()}};return this.functionRegistry?.register(d,c),d}};function createTypeExtension$5(a,b){return new FunctionTypeExtension(a,b)}var NullTypeExtension=class extends LuaTypeExtension{gcPointer;constructor(a){if(super(a,"js_null"),this.gcPointer=a.lua.module.addFunction(b=>{const c=a.lua.luaL_checkudata(b,1,this.name),d=a.lua.module.getValue(c,"*");return a.lua.unref(d),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)){const b=a.lua.lua_gettop(a.address);a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_setfield(a.address,b,"__metatable"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_setfield(a.address,b,"__gc"),a.pushValue(()=>null),a.lua.lua_setfield(a.address,b,"__index"),a.pushValue(()=>"null"),a.lua.lua_setfield(a.address,b,"__tostring"),a.pushValue((c,d)=>c===d),a.lua.lua_setfield(a.address,b,"__eq")}a.lua.lua_pop(a.address,1),super.pushValue(a,new Decoration({},{})),a.lua.lua_setglobal(a.address,"null")}getValue(a,b){const c=a.lua.luaL_testudata(a.address,b,this.name);if(!c)throw Error(`data does not have the expected metatable: ${this.name}`);return null}pushValue(a,b){return b?.target===null?(a.lua.lua_getglobal(a.address,"null"),!0):!1}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function createTypeExtension$4(a){return new NullTypeExtension(a)}const isPromise=a=>a&&(Promise.resolve(a)===a||typeof a.then=="function");var PromiseTypeExtension=class extends LuaTypeExtension{gcPointer;constructor(a,b){if(super(a,"js_promise"),this.gcPointer=a.lua.module.addFunction(c=>{const d=a.lua.luaL_checkudata(c,1,this.name),e=a.lua.module.getValue(d,"*");return a.lua.unref(e),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)){const c=a.lua.lua_gettop(a.address);a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_setfield(a.address,c,"__metatable"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_setfield(a.address,c,"__gc");const d=e=>{if(!isPromise(e))throw Error("self instance is not a promise");return!0};a.pushValue({next:(e,...f)=>d(e)&&e.then(...f),catch:(e,...f)=>d(e)&&e.catch(...f),finally:(e,...f)=>d(e)&&e.finally(...f),await:decorateFunction((e,f)=>{if(d(f),e.address===a.address)throw Error("cannot await in the main thread");let g;const h=f.then(j=>{g={status:"fulfilled",value:j}}).catch(j=>{g={status:"rejected",value:j}}),i=this.thread.lua.module.addFunction(j=>{if(!g)return a.lua.lua_yieldk(e.address,0,0,i);this.thread.lua.module.removeFunction(i);const k=a.stateToThread(j);if(g.status==="rejected")return k.pushValue(g.value||Error("promise rejected with no error")),this.thread.lua.lua_error(j);if(g.value instanceof RawResult)return g.value.count;if(g.value instanceof MultiReturn){for(const l of g.value)k.pushValue(l);return g.value.length}return k.pushValue(g.value),1},"iiii");return e.pushValue(h),new RawResult(a.lua.lua_yieldk(e.address,1,0,i))},{receiveThread:!0})}),a.lua.lua_setfield(a.address,c,"__index"),a.pushValue((e,f)=>e===f),a.lua.lua_setfield(a.address,c,"__eq")}a.lua.lua_pop(a.address,1),b&&a.set("Promise",{create:c=>new Promise(c),all:c=>{if(!Array.isArray(c))throw Error("argument must be an array of promises");return Promise.all(c.map(d=>Promise.resolve(d)))},resolve:c=>Promise.resolve(c)})}close(){this.thread.lua.module.removeFunction(this.gcPointer)}pushValue(a,b){return isPromise(b.target)?super.pushValue(a,b):!1}};function createTypeExtension$3(a,b){return new PromiseTypeExtension(a,b)}function decorateProxy(a,b){return new Decoration(a,b||{})}var ProxyTypeExtension=class extends LuaTypeExtension{gcPointer;constructor(a){if(super(a,"js_proxy"),this.gcPointer=a.lua.module.addFunction(b=>{const c=a.lua.luaL_checkudata(b,1,this.name),d=a.lua.module.getValue(c,"*");return a.lua.unref(d),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)){const b=a.lua.lua_gettop(a.address);a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_setfield(a.address,b,"__metatable"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_setfield(a.address,b,"__gc"),a.pushValue((c,d)=>{switch(typeof d){case"number":--d;case"string":break;default:throw Error("Only strings or numbers can index js objects")}const e=c[d];return typeof e=="function"?decorateFunction(e,{self:c}):e}),a.lua.lua_setfield(a.address,b,"__index"),a.pushValue((c,d,e)=>{switch(typeof d){case"number":--d;case"string":break;default:throw Error("Only strings or numbers can index js objects")}c[d]=e}),a.lua.lua_setfield(a.address,b,"__newindex"),a.pushValue(c=>c.toString?.()??typeof c),a.lua.lua_setfield(a.address,b,"__tostring"),a.pushValue(c=>c.length||0),a.lua.lua_setfield(a.address,b,"__len"),a.pushValue(c=>{const d=Object.getOwnPropertyNames(c);let e=0;return MultiReturn.of(()=>{const f=MultiReturn.of(d[e],c[d[e]]);return e++,f},c,null)}),a.lua.lua_setfield(a.address,b,"__pairs"),a.pushValue((c,d)=>c===d),a.lua.lua_setfield(a.address,b,"__eq"),a.pushValue((c,...d)=>(d[0]===c&&d.shift(),c(...d))),a.lua.lua_setfield(a.address,b,"__call")}a.lua.lua_pop(a.address,1)}isType(a,b,c,d){return c===LuaType.Userdata&&d===this.name}getValue(a,b){const c=a.lua.lua_touserdata(a.address,b),d=a.lua.module.getValue(c,"*");return a.lua.getRef(d)}pushValue(a,b){const{target:c,options:d}=b;if(d.proxy===void 0){if(c==null)return!1;if(typeof c!="object"){const e=typeof c=="function"&&c.prototype?.constructor===c&&c.toString().startsWith("class ");if(!e)return!1}if(isPromise(c))return!1}else if(d.proxy===!1)return!1;return d.metatable&&!(d.metatable instanceof Decoration)?(b.options.metatable=decorateProxy(d.metatable,{proxy:!1}),!1):super.pushValue(a,b)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function createTypeExtension$2(a){return new ProxyTypeExtension(a)}var TableTypeExtension=class extends LuaTypeExtension{constructor(a){super(a,"js_table")}close(){}isType(a,b,c){return c===LuaType.Table}getValue(a,b,c){const d=c||new Map,e=a.lua.lua_topointer(a.address,b);let f=d.get(e);if(!f){const g=this.readTableKeys(a,b),h=g.length>0&&g.every((i,j)=>i===String(j+1));f=h?[]:{},d.set(e,f),this.readTableValues(a,b,d,f)}return f}pushValue(a,{target:b},c){if(typeof b!="object"||b===null)return!1;const d=c||new Map,e=d.get(b);if(e!==void 0)return a.lua.lua_rawgeti(a.address,LUA_REGISTRYINDEX,BigInt(e)),!0;try{const f=a.getTop()+1,g=(h,i)=>{a.lua.lua_createtable(a.address,h,i);const j=a.lua.luaL_ref(a.address,LUA_REGISTRYINDEX);d.set(b,j),a.lua.lua_rawgeti(a.address,LUA_REGISTRYINDEX,BigInt(j))};if(Array.isArray(b)){g(b.length,0);for(let h=0;h<b.length;h++)a.pushValue(h+1,d),a.pushValue(b[h],d),a.lua.lua_settable(a.address,f)}else for(const h in g(0,Object.getOwnPropertyNames(b).length),b)a.pushValue(h,d),a.pushValue(b[h],d),a.lua.lua_settable(a.address,f)}finally{if(c===void 0)for(const f of d.values())a.lua.luaL_unref(a.address,LUA_REGISTRYINDEX,f)}return!0}readTableKeys(a,b){const c=[];for(a.lua.lua_pushnil(a.address);a.lua.lua_next(a.address,b);){const d=a.indexToString(-2);c.push(d),a.pop()}return c}readTableValues(a,b,c,d){const e=Array.isArray(d);for(a.lua.lua_pushnil(a.address);a.lua.lua_next(a.address,b);){const f=a.indexToString(-2),g=a.getValue(-1,void 0,c);e?d.push(g):d[f]=g,a.pop()}}};function createTypeExtension$1(a){return new TableTypeExtension(a)}function decorateUserdata(a){return new Decoration(a,{reference:!0})}var UserdataTypeExtension=class extends LuaTypeExtension{gcPointer;constructor(a){if(super(a,"js_userdata"),this.gcPointer=a.lua.module.addFunction(b=>{const c=a.lua.luaL_checkudata(b,1,this.name),d=a.lua.module.getValue(c,"*");return a.lua.unref(d),LuaReturn.Ok},"ii"),a.lua.luaL_newmetatable(a.address,this.name)){const b=a.lua.lua_gettop(a.address);a.lua.lua_pushstring(a.address,"protected metatable"),a.lua.lua_setfield(a.address,b,"__metatable"),a.lua.lua_pushcclosure(a.address,this.gcPointer,0),a.lua.lua_setfield(a.address,b,"__gc")}a.lua.lua_pop(a.address,1)}isType(a,b,c,d){return c===LuaType.Userdata&&d===this.name}getValue(a,b){const c=a.lua.lua_touserdata(a.address,b),d=a.lua.module.getValue(c,"*");return a.lua.getRef(d)}pushValue(a,b){return b.options.reference?super.pushValue(a,b):!1}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};function createTypeExtension(a){return new UserdataTypeExtension(a)}var LuaEngine=class{global;constructor(a,{openStandardLibs:b=!0,injectObjects:c=!1,enableProxy:d=!0,traceAllocations:e=!1,functionTimeout:f=void 0}={}){this.cmodule=a,this.global=new Global(this.cmodule,e),this.global.registerTypeExtension(0,createTypeExtension$1(this.global)),this.global.registerTypeExtension(0,createTypeExtension$5(this.global,{functionTimeout:f})),this.global.registerTypeExtension(1,createTypeExtension$3(this.global,c)),c&&this.global.registerTypeExtension(5,createTypeExtension$4(this.global)),d?this.global.registerTypeExtension(3,createTypeExtension$2(this.global)):this.global.registerTypeExtension(1,createTypeExtension$6(this.global,c)),this.global.registerTypeExtension(4,createTypeExtension(this.global)),b&&this.cmodule.luaL_openlibs(this.global.address)}doString(a){return this.callByteCode(b=>b.loadString(a))}doFile(a){return this.callByteCode(b=>b.loadFile(a))}doStringSync(a){this.global.loadString(a);const b=this.global.runSync();return b[0]}doFileSync(a){this.global.loadFile(a);const b=this.global.runSync();return b[0]}async callByteCode(a){const b=this.global.newThread(),c=this.global.getTop();try{a(b);const d=await b.run(0);if(d.length>0)return b.getValue(b.getTop()-d.length+1);return}finally{this.global.remove(c)}}},package_version_default="1.16.0",initWasmModule=(()=>{var a=Object(import.meta).url;return async function(b={}){var c,d=b,e,f,g=new Promise((H,I)=>{e=H,f=I}),h=typeof window=="object",i=typeof importScripts=="function",j=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(j){const{createRequire:H}=await import("module");let I=Object(import.meta).url;I.startsWith("data:")&&(I="/");var k=H(I)}var l=Object.assign({},d),Ra=[],Sa="./this.program",Ta=(H,I)=>{throw I},m="";function Ua(H){return d.locateFile?d.locateFile(H,m):m+H}var Va,Wa;if(j){var Xa=k("fs");var Ya=k("path");Object(import.meta).url.startsWith("data:")||(m=Ya.dirname(k("url").fileURLToPath(Object(import.meta).url))+"/"),Wa=H=>{H=zb(H)?new URL(H):Ya.normalize(H);var I=Xa.readFileSync(H);return I},Va=(H,I=!0)=>(H=zb(H)?new URL(H):Ya.normalize(H),new Promise((J,K)=>{Xa.readFile(H,I?void 0:"utf8",(L,M)=>{L?K(L):J(I?M.buffer:M)})})),!d.thisProgram&&process.argv.length>1&&(Sa=process.argv[1].replace(/\\/g,"/")),Ra=process.argv.slice(2),Ta=(H,I)=>{throw process.exitCode=H,I}}else (h||i)&&(i?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),a&&(m=a),m=m.startsWith("blob:")?"":m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1),i&&(Wa=H=>{var I=new XMLHttpRequest;return I.open("GET",H,!1),I.responseType="arraybuffer",I.send(null),new Uint8Array(I.response)}),Va=H=>fetch(H,{credentials:"same-origin"}).then(I=>I.ok?I.arrayBuffer():Promise.reject(Error(I.status+" : "+I.url))));var Za=console.log.bind(console),n=console.error.bind(console);Object.assign(d,l),l=null;var $a,_a,ab=!1,bb,o,cb,p,db,q,r,eb,s,fb,gb;function hb(){var H=_a.buffer;o=new Int8Array(H),p=new Int16Array(H),cb=new Uint8Array(H),db=new Uint16Array(H),q=new Int32Array(H),r=new Uint32Array(H),eb=new Float32Array(H),gb=new Float64Array(H),s=new BigInt64Array(H),fb=new BigUint64Array(H)}var ib=[],jb=[],kb=[],lb=!1;function mb(){var H=d.preRun;H&&(typeof H=="function"&&(H=[H]),H.forEach(pb)),Jb(ib)}function nb(){lb=!0,!d.noFSInit&&!A.initialized&&A.init(),A.ignorePermissions=!1,y.init(),Jb(jb)}function ob(){Jb(kb)}function pb(H){ib.unshift(H)}function qb(H){jb.unshift(H)}var rb=0,sb=null,tb=null;function ub(H){return H}function vb(H){rb++}function wb(H){if(rb--,rb==0&&(sb!==null&&(clearInterval(sb),sb=null),tb)){var I=tb;tb=null,I()}}function t(H){H="Aborted("+H+")",n(H),ab=!0,H+=". Build with -sASSERTIONS for more info.";var I=new WebAssembly.RuntimeError(H);throw f(I),I}var xb="data:application/octet-stream;base64,",yb=H=>H.startsWith(xb),zb=H=>H.startsWith("file://");function Ab(){if(d.locateFile){var H="objlua.wasm";return yb(H)?H:Ua(H)}return new URL("objlua.wasm",Object(import.meta).url).href}var Bb;function Cb(H){if(H==Bb&&$a)return new Uint8Array($a);if(Wa)return Wa(H);throw"both async and sync fetching of the wasm failed"}function Db(H){return $a?Promise.resolve().then(()=>Cb(H)):Va(H).then(I=>new Uint8Array(I),()=>Cb(H))}function Eb(H,I,J){return Db(H).then(K=>WebAssembly.instantiate(K,I)).then(J,K=>{n(`failed to asynchronously prepare wasm: ${K}`),t(K)})}function Fb(H,I,J,K){return!H&&typeof WebAssembly.instantiateStreaming=="function"&&!yb(I)&&!j&&typeof fetch=="function"?fetch(I,{credentials:"same-origin"}).then(L=>{var M=WebAssembly.instantiateStreaming(L,J);return M.then(K,function(N){return n(`wasm streaming compile failed: ${N}`),n("falling back to ArrayBuffer instantiation"),Eb(I,J,K)})}):Eb(I,J,K)}function Gb(){return{a:nd}}function Hb(){var H=Gb();function I(K,L){return G=K.exports,_a=G.A,hb(),E=G._a,qb(G.B),wb("wasm-instantiate"),G}vb("wasm-instantiate");function J(K){I(K.instance)}return Bb??=Ab(),Fb($a,Bb,H,J).catch(f),{}}function Ib(H){this.name="ExitStatus",this.message=`Program terminated with exit(${H})`,this.status=H}var Jb=H=>{H.forEach(I=>I(d))};function Kb(H,I="i8"){switch(I.endsWith("*")&&(I="*"),I){case"i1":return o[H];case"i8":return o[H];case"i16":return p[H>>1];case"i32":return q[H>>2];case"i64":return s[H>>3];case"float":return eb[H>>2];case"double":return gb[H>>3];case"*":return r[H>>2];default:t(`invalid type for getValue: ${I}`)}}function Lb(H,I,J="i8"){switch(J.endsWith("*")&&(J="*"),J){case"i1":o[H]=I;break;case"i8":o[H]=I;break;case"i16":p[H>>1]=I;break;case"i32":q[H>>2]=I;break;case"i64":s[H>>3]=BigInt(I);break;case"float":eb[H>>2]=I;break;case"double":gb[H>>3]=I;break;case"*":r[H>>2]=I;break;default:t(`invalid type for setValue: ${J}`)}}var Mb=H=>hg(H),Nb=()=>jg(),u={isAbs:H=>H.charAt(0)==="/",splitPath:H=>{var I=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return I.exec(H).slice(1)},normalizeArray:(H,I)=>{for(var J=0,K=H.length-1;K>=0;K--){var L=H[K];L==="."?H.splice(K,1):L===".."?(H.splice(K,1),J++):J&&(H.splice(K,1),J--)}if(I)for(;J;J--)H.unshift("..");return H},normalize:H=>{var I=u.isAbs(H),J=H.substr(-1)==="/";return H=u.normalizeArray(H.split("/").filter(K=>!!K),!I).join("/"),!H&&!I&&(H="."),H&&J&&(H+="/"),(I?"/":"")+H},dirname:H=>{var I=u.splitPath(H),J=I[0],K=I[1];return!J&&!K?".":(K&&=K.substr(0,K.length-1),J+K)},basename:H=>{if(H==="/")return"/";H=u.normalize(H),H=H.replace(/\/$/,"");var I=H.lastIndexOf("/");return I===-1?H:H.substr(I+1)},join:(...H)=>u.normalize(H.join("/")),join2:(H,I)=>u.normalize(H+"/"+I)},Ob=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return K=>crypto.getRandomValues(K);if(j)try{var H=k("crypto");var I=H.randomFillSync;if(I)return K=>H.randomFillSync(K);var J=H.randomBytes;return K=>(K.set(J(K.byteLength)),K)}catch{}t("initRandomDevice")},Pb=H=>(Pb=Ob())(H),v={resolve:(...H)=>{for(var I="",J=!1,K=H.length-1;K>=-1&&!J;K--){var L=K>=0?H[K]:A.cwd();if(typeof L!="string")throw TypeError("Arguments to path.resolve must be strings");if(!L)return"";I=L+"/"+I,J=u.isAbs(L)}return I=u.normalizeArray(I.split("/").filter(M=>!!M),!J).join("/"),(J?"/":"")+I||"."},relative:(H,I)=>{H=v.resolve(H).substr(1),I=v.resolve(I).substr(1);function J(Q){for(var R=0;R<Q.length;R++)if(Q[R]!=="")break;for(var S=Q.length-1;S>=0;S--)if(Q[S]!=="")break;return R>S?[]:Q.slice(R,S-R+1)}for(var K=J(H.split("/")),L=J(I.split("/")),M=Math.min(K.length,L.length),N=M,O=0;O<M;O++)if(K[O]!==L[O]){N=O;break}for(var P=[],O=N;O<K.length;O++)P.push("..");return P=P.concat(L.slice(N)),P.join("/")}},Qb=typeof TextDecoder<"u"?new TextDecoder:void 0,w=(H,I=0,J=NaN)=>{for(var K=I+J,L=I;H[L]&&!(L>=K);)++L;if(L-I>16&&H.buffer&&Qb)return Qb.decode(H.subarray(I,L));for(var M="";I<L;){var N=H[I++];if(!(N&128)){M+=String.fromCharCode(N);continue}var O=H[I++]&63;if((N&224)==192){M+=String.fromCharCode((N&31)<<6|O);continue}var P=H[I++]&63;if(N=(N&240)==224?(N&15)<<12|O<<6|P:(N&7)<<18|O<<12|P<<6|H[I++]&63,N<65536)M+=String.fromCharCode(N);else{var Q=N-65536;M+=String.fromCharCode(55296|Q>>10,56320|Q&1023)}}return M},Rb=[],x=H=>{for(var I=0,J=0;J<H.length;++J){var K=H.charCodeAt(J);K<=127?I++:K<=2047?I+=2:K>=55296&&K<=57343?(I+=4,++J):I+=3}return I},Sb=(H,I,J,K)=>{if(!(K>0))return 0;for(var L=J,M=J+K-1,N=0;N<H.length;++N){var O=H.charCodeAt(N);if(O>=55296&&O<=57343){var P=H.charCodeAt(++N);O=65536+((O&1023)<<10)|P&1023}if(O<=127){if(J>=M)break;I[J++]=O}else if(O<=2047){if(J+1>=M)break;I[J++]=192|O>>6,I[J++]=128|O&63}else if(O<=65535){if(J+2>=M)break;I[J++]=224|O>>12,I[J++]=128|O>>6&63,I[J++]=128|O&63}else{if(J+3>=M)break;I[J++]=240|O>>18,I[J++]=128|O>>12&63,I[J++]=128|O>>6&63,I[J++]=128|O&63}}return I[J]=0,J-L};function Tb(H,I,J){var K=J>0?J:x(H)+1,L=Array(K),M=Sb(H,L,0,L.length);return I&&(L.length=M),L}var Ub=()=>{if(!Rb.length){var H=null;if(j){var I=256,J=Buffer.alloc(I),K=0,L=process.stdin.fd;try{K=Xa.readSync(L,J,0,I)}catch(M){if(M.toString().includes("EOF"))K=0;else throw M}K>0&&(H=J.slice(0,K).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(H=window.prompt("Input: "),H!==null&&(H+=`
`));if(!H)return null;Rb=Tb(H,!0)}return Rb.shift()},y={ttys:[],init(){},shutdown(){},register(H,I){y.ttys[H]={input:[],output:[],ops:I},A.registerDevice(H,y.stream_ops)},stream_ops:{open(H){var I=y.ttys[H.node.rdev];if(!I)throw new A.ErrnoError(43);H.tty=I,H.seekable=!1},close(H){H.tty.ops.fsync(H.tty)},fsync(H){H.tty.ops.fsync(H.tty)},read(H,I,J,K,L){if(!H.tty||!H.tty.ops.get_char)throw new A.ErrnoError(60);for(var M=0,N=0;N<K;N++){var O;try{O=H.tty.ops.get_char(H.tty)}catch{throw new A.ErrnoError(29)}if(O===void 0&&M===0)throw new A.ErrnoError(6);if(O==null)break;M++,I[J+N]=O}return M&&(H.node.timestamp=Date.now()),M},write(H,I,J,K,L){if(!H.tty||!H.tty.ops.put_char)throw new A.ErrnoError(60);try{for(var M=0;M<K;M++)H.tty.ops.put_char(H.tty,I[J+M])}catch{throw new A.ErrnoError(29)}return K&&(H.node.timestamp=Date.now()),M}},default_tty_ops:{get_char(H){return Ub()},put_char(H,I){I===null||I===10?(Za(w(H.output)),H.output=[]):I!=0&&H.output.push(I)},fsync(H){H.output&&H.output.length>0&&(Za(w(H.output)),H.output=[])},ioctl_tcgets(H){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(H,I,J){return 0},ioctl_tiocgwinsz(H){return[24,80]}},default_tty1_ops:{put_char(H,I){I===null||I===10?(n(w(H.output)),H.output=[]):I!=0&&H.output.push(I)},fsync(H){H.output&&H.output.length>0&&(n(w(H.output)),H.output=[])}}},Vb=(H,I)=>Math.ceil(H/I)*I,Wb=H=>{t()},z={ops_table:null,mount(H){return z.createNode(null,"/",16895,0)},createNode(H,I,J,K){if(A.isBlkdev(J)||A.isFIFO(J))throw new A.ErrnoError(63);z.ops_table||={dir:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr,lookup:z.node_ops.lookup,mknod:z.node_ops.mknod,rename:z.node_ops.rename,unlink:z.node_ops.unlink,rmdir:z.node_ops.rmdir,readdir:z.node_ops.readdir,symlink:z.node_ops.symlink},stream:{llseek:z.stream_ops.llseek}},file:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr},stream:{llseek:z.stream_ops.llseek,read:z.stream_ops.read,write:z.stream_ops.write,allocate:z.stream_ops.allocate,mmap:z.stream_ops.mmap,msync:z.stream_ops.msync}},link:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr,readlink:z.node_ops.readlink},stream:{}},chrdev:{node:{getattr:z.node_ops.getattr,setattr:z.node_ops.setattr},stream:A.chrdev_stream_ops}};var L=A.createNode(H,I,J,K);return A.isDir(L.mode)?(L.node_ops=z.ops_table.dir.node,L.stream_ops=z.ops_table.dir.stream,L.contents={}):A.isFile(L.mode)?(L.node_ops=z.ops_table.file.node,L.stream_ops=z.ops_table.file.stream,L.usedBytes=0,L.contents=null):A.isLink(L.mode)?(L.node_ops=z.ops_table.link.node,L.stream_ops=z.ops_table.link.stream):A.isChrdev(L.mode)&&(L.node_ops=z.ops_table.chrdev.node,L.stream_ops=z.ops_table.chrdev.stream),L.timestamp=Date.now(),H&&(H.contents[I]=L,H.timestamp=L.timestamp),L},getFileDataAsTypedArray(H){return H.contents?H.contents.subarray?H.contents.subarray(0,H.usedBytes):new Uint8Array(H.contents):new Uint8Array},expandFileStorage(H,I){var J=H.contents?H.contents.length:0;if(J>=I)return;var K=1024*1024;I=Math.max(I,J*(J<K?2:1.125)>>>0),J!=0&&(I=Math.max(I,256));var L=H.contents;H.contents=new Uint8Array(I),H.usedBytes>0&&H.contents.set(L.subarray(0,H.usedBytes),0)},resizeFileStorage(H,I){if(H.usedBytes==I)return;if(I==0)H.contents=null,H.usedBytes=0;else{var J=H.contents;H.contents=new Uint8Array(I),J&&H.contents.set(J.subarray(0,Math.min(I,H.usedBytes))),H.usedBytes=I}},node_ops:{getattr(H){var I={};return I.dev=A.isChrdev(H.mode)?H.id:1,I.ino=H.id,I.mode=H.mode,I.nlink=1,I.uid=0,I.gid=0,I.rdev=H.rdev,A.isDir(H.mode)?I.size=4096:A.isFile(H.mode)?I.size=H.usedBytes:A.isLink(H.mode)?I.size=H.link.length:I.size=0,I.atime=new Date(H.timestamp),I.mtime=new Date(H.timestamp),I.ctime=new Date(H.timestamp),I.blksize=4096,I.blocks=Math.ceil(I.size/I.blksize),I},setattr(H,I){I.mode!==void 0&&(H.mode=I.mode),I.timestamp!==void 0&&(H.timestamp=I.timestamp),I.size!==void 0&&z.resizeFileStorage(H,I.size)},lookup(H,I){throw A.genericErrors[44]},mknod(H,I,J,K){return z.createNode(H,I,J,K)},rename(H,I,J){if(A.isDir(H.mode)){var K;try{K=A.lookupNode(I,J)}catch{}if(K)for(var L in K.contents)throw new A.ErrnoError(55)}delete H.parent.contents[H.name],H.parent.timestamp=Date.now(),H.name=J,I.contents[J]=H,I.timestamp=H.parent.timestamp},unlink(H,I){delete H.contents[I],H.timestamp=Date.now()},rmdir(H,I){var J=A.lookupNode(H,I);for(var K in J.contents)throw new A.ErrnoError(55);delete H.contents[I],H.timestamp=Date.now()},readdir(H){var I=[".",".."];for(var J of Object.keys(H.contents))I.push(J);return I},symlink(H,I,J){var K=z.createNode(H,I,41471,0);return K.link=J,K},readlink(H){if(!A.isLink(H.mode))throw new A.ErrnoError(28);return H.link}},stream_ops:{read(H,I,J,K,L){var M=H.node.contents;if(L>=H.node.usedBytes)return 0;var N=Math.min(H.node.usedBytes-L,K);if(N>8&&M.subarray)I.set(M.subarray(L,L+N),J);else for(var O=0;O<N;O++)I[J+O]=M[L+O];return N},write(H,I,J,K,L,M){if(I.buffer===o.buffer&&(M=!1),!K)return 0;var N=H.node;if(N.timestamp=Date.now(),I.subarray&&(!N.contents||N.contents.subarray)){if(M)return N.contents=I.subarray(J,J+K),N.usedBytes=K,K;if(N.usedBytes===0&&L===0)return N.contents=I.slice(J,J+K),N.usedBytes=K,K;if(L+K<=N.usedBytes)return N.contents.set(I.subarray(J,J+K),L),K}if(z.expandFileStorage(N,L+K),N.contents.subarray&&I.subarray)N.contents.set(I.subarray(J,J+K),L);else for(var O=0;O<K;O++)N.contents[L+O]=I[J+O];return N.usedBytes=Math.max(N.usedBytes,L+K),K},llseek(H,I,J){var K=I;if(J===1?K+=H.position:J===2&&A.isFile(H.node.mode)&&(K+=H.node.usedBytes),K<0)throw new A.ErrnoError(28);return K},allocate(H,I,J){z.expandFileStorage(H.node,I+J),H.node.usedBytes=Math.max(H.node.usedBytes,I+J)},mmap(H,I,J,K,L){if(!A.isFile(H.node.mode))throw new A.ErrnoError(43);var M,N,O=H.node.contents;if(!(L&2)&&O&&O.buffer===o.buffer)N=!1,M=O.byteOffset;else{if(N=!0,M=Wb(I),!M)throw new A.ErrnoError(48);O&&((J>0||J+I<O.length)&&(O=O.subarray?O.subarray(J,J+I):Array.prototype.slice.call(O,J,J+I)),o.set(O,M))}return{ptr:M,allocated:N}},msync(H,I,J,K,L){return z.stream_ops.write(H,I,0,K,J,!1),0}}},Xb=(H,I,J,K)=>{var L=K?"":ub(`al ${H}`);Va(H).then(M=>{I(new Uint8Array(M)),L&&wb(L)},M=>{if(J)J();else throw`Loading data file "${H}" failed.`}),L&&vb(L)},Yb=(H,I,J,K,L,M)=>{A.createDataFile(H,I,J,K,L,M)},Zb=[],$b=(H,I,J,K)=>{typeof Browser<"u"&&Browser.init();var L=!1;return Zb.forEach(M=>{if(L)return;M.canHandle(I)&&(M.handle(H,I,J,K),L=!0)}),L},_b=(H,I,J,K,L,M,N,O,P,Q)=>{var R=I?v.resolve(u.join2(H,I)):H,S=ub(`cp ${R}`);function T(U){function V(W){Q?.(),O||Yb(H,I,W,K,L,P),M?.(),wb(S)}if($b(U,R,V,()=>{N?.(),wb(S)}))return;V(U)}vb(S),typeof J=="string"?Xb(J,T,N):T(J)},ac=H=>{var I={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},J=I[H];if(J===void 0)throw Error(`Unknown file open mode: ${H}`);return J},bc=(H,I)=>{var J=0;return H&&(J|=365),I&&(J|=146),J},A={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(H){this.name="ErrnoError",this.errno=H}},genericErrors:{},filesystems:null,syncFSRequests:0,FSStream:class{constructor(){this.shared={}}get object(){return this.node}set object(H){this.node=H}get isRead(){return(this.flags&2097155)!=1}get isWrite(){return(this.flags&2097155)!=0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(H){this.shared.flags=H}get position(){return this.shared.position}set position(H){this.shared.position=H}},FSNode:class{constructor(H,I,J,K){H||=this,this.parent=H,this.mount=H.mount,this.mounted=null,this.id=A.nextInode++,this.name=I,this.mode=J,this.node_ops={},this.stream_ops={},this.rdev=K,this.readMode=365,this.writeMode=146}get read(){return(this.mode&this.readMode)===this.readMode}set read(H){H?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(H){H?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return A.isDir(this.mode)}get isDevice(){return A.isChrdev(this.mode)}},lookupPath(H,I={}){if(H=v.resolve(H),!H)return{path:"",node:null};var J={follow_mount:!0,recurse_count:0};if(I=Object.assign(J,I),I.recurse_count>8)throw new A.ErrnoError(32);for(var K=H.split("/").filter(S=>!!S),L=A.root,M="/",N=0;N<K.length;N++){var O=N===K.length-1;if(O&&I.parent)break;if(L=A.lookupNode(L,K[N]),M=u.join2(M,K[N]),A.isMountpoint(L)&&(!O||O&&I.follow_mount)&&(L=L.mounted.root),!O||I.follow)for(var P=0;A.isLink(L.mode);){var Q=A.readlink(M);M=v.resolve(u.dirname(M),Q);var R=A.lookupPath(M,{recurse_count:I.recurse_count+1});if(L=R.node,P++>40)throw new A.ErrnoError(32)}}return{path:M,node:L}},getPath(H){for(var I;;){if(A.isRoot(H)){var J=H.mount.mountpoint;return I?J[J.length-1]==="/"?J+I:`${J}/${I}`:J}I=I?`${H.name}/${I}`:H.name,H=H.parent}},hashName(H,I){for(var J=0,K=0;K<I.length;K++)J=(J<<5)-J+I.charCodeAt(K)|0;return(H+J>>>0)%A.nameTable.length},hashAddNode(H){var I=A.hashName(H.parent.id,H.name);H.name_next=A.nameTable[I],A.nameTable[I]=H},hashRemoveNode(H){var I=A.hashName(H.parent.id,H.name);if(A.nameTable[I]===H)A.nameTable[I]=H.name_next;else for(var J=A.nameTable[I];J;){if(J.name_next===H){J.name_next=H.name_next;break}J=J.name_next}},lookupNode(H,I){var J=A.mayLookup(H);if(J)throw new A.ErrnoError(J);for(var K=A.hashName(H.id,I),L=A.nameTable[K];L;L=L.name_next){var M=L.name;if(L.parent.id===H.id&&M===I)return L}return A.lookup(H,I)},createNode(H,I,J,K){var L=new A.FSNode(H,I,J,K);return A.hashAddNode(L),L},destroyNode(H){A.hashRemoveNode(H)},isRoot(H){return H===H.parent},isMountpoint(H){return!!H.mounted},isFile(H){return(H&61440)==32768},isDir(H){return(H&61440)==16384},isLink(H){return(H&61440)==40960},isChrdev(H){return(H&61440)==8192},isBlkdev(H){return(H&61440)==24576},isFIFO(H){return(H&61440)==4096},isSocket(H){return(H&49152)==49152},flagsToPermissionString(H){var I=["r","w","rw"][H&3];return H&512&&(I+="w"),I},nodePermissions(H,I){return A.ignorePermissions?0:I.includes("r")&&!(H.mode&292)||I.includes("w")&&!(H.mode&146)||I.includes("x")&&!(H.mode&73)?2:0},mayLookup(H){if(!A.isDir(H.mode))return 54;var I=A.nodePermissions(H,"x");return I||(H.node_ops.lookup?0:2)},mayCreate(H,I){try{var J=A.lookupNode(H,I);return 20}catch{}return A.nodePermissions(H,"wx")},mayDelete(H,I,J){var K;try{K=A.lookupNode(H,I)}catch(M){return M.errno}var L=A.nodePermissions(H,"wx");if(L)return L;if(J){if(!A.isDir(K.mode))return 54;if(A.isRoot(K)||A.getPath(K)===A.cwd())return 10}else if(A.isDir(K.mode))return 31;return 0},mayOpen(H,I){return H?A.isLink(H.mode)?32:A.isDir(H.mode)&&(A.flagsToPermissionString(I)!=="r"||I&512)?31:A.nodePermissions(H,A.flagsToPermissionString(I)):44},MAX_OPEN_FDS:4096,nextfd(){for(var H=0;H<=A.MAX_OPEN_FDS;H++)if(!A.streams[H])return H;throw new A.ErrnoError(33)},getStreamChecked(H){var I=A.getStream(H);if(!I)throw new A.ErrnoError(8);return I},getStream:H=>A.streams[H],createStream(H,I=-1){return H=Object.assign(new A.FSStream,H),I==-1&&(I=A.nextfd()),H.fd=I,A.streams[I]=H,H},closeStream(H){A.streams[H]=null},dupStream(H,I=-1){var J=A.createStream(H,I);return J.stream_ops?.dup?.(J),J},chrdev_stream_ops:{open(H){var I=A.getDevice(H.node.rdev);H.stream_ops=I.stream_ops,H.stream_ops.open?.(H)},llseek(){throw new A.ErrnoError(70)}},major:H=>H>>8,minor:H=>H&255,makedev:(H,I)=>H<<8|I,registerDevice(H,I){A.devices[H]={stream_ops:I}},getDevice:H=>A.devices[H],getMounts(H){for(var I=[],J=[H];J.length;){var K=J.pop();I.push(K),J.push(...K.mounts)}return I},syncfs(H,I){typeof H=="function"&&(I=H,H=!1),A.syncFSRequests++,A.syncFSRequests>1&&n(`warning: ${A.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var J=A.getMounts(A.root.mount),K=0;function L(N){return A.syncFSRequests--,I(N)}function M(N){if(N){if(!M.errored)return M.errored=!0,L(N);return}++K>=J.length&&L(null)}J.forEach(N=>{if(!N.type.syncfs)return M(null);N.type.syncfs(N,H,M)})},mount(H,I,J){var K=J==="/",L=!J,M;if(K&&A.root)throw new A.ErrnoError(10);if(!K&&!L){var N=A.lookupPath(J,{follow_mount:!1});if(J=N.path,M=N.node,A.isMountpoint(M))throw new A.ErrnoError(10);if(!A.isDir(M.mode))throw new A.ErrnoError(54)}var O={type:H,opts:I,mountpoint:J,mounts:[]},P=H.mount(O);return P.mount=O,O.root=P,K?A.root=P:M&&(M.mounted=O,M.mount&&M.mount.mounts.push(O)),P},unmount(H){var I=A.lookupPath(H,{follow_mount:!1});if(!A.isMountpoint(I.node))throw new A.ErrnoError(28);var J=I.node,K=J.mounted,L=A.getMounts(K);Object.keys(A.nameTable).forEach(N=>{for(var O=A.nameTable[N];O;){var P=O.name_next;L.includes(O.mount)&&A.destroyNode(O),O=P}}),J.mounted=null;var M=J.mount.mounts.indexOf(K);J.mount.mounts.splice(M,1)},lookup(H,I){return H.node_ops.lookup(H,I)},mknod(H,I,J){var K=A.lookupPath(H,{parent:!0}),L=K.node,M=u.basename(H);if(!M||M==="."||M==="..")throw new A.ErrnoError(28);var N=A.mayCreate(L,M);if(N)throw new A.ErrnoError(N);if(!L.node_ops.mknod)throw new A.ErrnoError(63);return L.node_ops.mknod(L,M,I,J)},create(H,I){return I=I===void 0?438:I,I&=4095,I|=32768,A.mknod(H,I,0)},mkdir(H,I){return I=I===void 0?511:I,I&=1023,I|=16384,A.mknod(H,I,0)},mkdirTree(H,I){for(var J=H.split("/"),K="",L=0;L<J.length;++L){if(!J[L])continue;K+="/"+J[L];try{A.mkdir(K,I)}catch(M){if(M.errno!=20)throw M}}},mkdev(H,I,J){return J===void 0&&(J=I,I=438),I|=8192,A.mknod(H,I,J)},symlink(H,I){if(!v.resolve(H))throw new A.ErrnoError(44);var J=A.lookupPath(I,{parent:!0}),K=J.node;if(!K)throw new A.ErrnoError(44);var L=u.basename(I),M=A.mayCreate(K,L);if(M)throw new A.ErrnoError(M);if(!K.node_ops.symlink)throw new A.ErrnoError(63);return K.node_ops.symlink(K,L,H)},rename(H,I){var J=u.dirname(H),K=u.dirname(I),L=u.basename(H),M=u.basename(I),N,O,P;if(N=A.lookupPath(H,{parent:!0}),O=N.node,N=A.lookupPath(I,{parent:!0}),P=N.node,!O||!P)throw new A.ErrnoError(44);if(O.mount!==P.mount)throw new A.ErrnoError(75);var Q=A.lookupNode(O,L),R=v.relative(H,K);if(R.charAt(0)!==".")throw new A.ErrnoError(28);if(R=v.relative(I,J),R.charAt(0)!==".")throw new A.ErrnoError(55);var S;try{S=A.lookupNode(P,M)}catch{}if(Q===S)return;var T=A.isDir(Q.mode),U=A.mayDelete(O,L,T);if(U)throw new A.ErrnoError(U);if(U=S?A.mayDelete(P,M,T):A.mayCreate(P,M),U)throw new A.ErrnoError(U);if(!O.node_ops.rename)throw new A.ErrnoError(63);if(A.isMountpoint(Q)||S&&A.isMountpoint(S))throw new A.ErrnoError(10);if(P!==O&&(U=A.nodePermissions(O,"w"),U))throw new A.ErrnoError(U);A.hashRemoveNode(Q);try{O.node_ops.rename(Q,P,M),Q.parent=P}catch(V){throw V}finally{A.hashAddNode(Q)}},rmdir(H){var I=A.lookupPath(H,{parent:!0}),J=I.node,K=u.basename(H),L=A.lookupNode(J,K),M=A.mayDelete(J,K,!0);if(M)throw new A.ErrnoError(M);if(!J.node_ops.rmdir)throw new A.ErrnoError(63);if(A.isMountpoint(L))throw new A.ErrnoError(10);J.node_ops.rmdir(J,K),A.destroyNode(L)},readdir(H){var I=A.lookupPath(H,{follow:!0}),J=I.node;if(!J.node_ops.readdir)throw new A.ErrnoError(54);return J.node_ops.readdir(J)},unlink(H){var I=A.lookupPath(H,{parent:!0}),J=I.node;if(!J)throw new A.ErrnoError(44);var K=u.basename(H),L=A.lookupNode(J,K),M=A.mayDelete(J,K,!1);if(M)throw new A.ErrnoError(M);if(!J.node_ops.unlink)throw new A.ErrnoError(63);if(A.isMountpoint(L))throw new A.ErrnoError(10);J.node_ops.unlink(J,K),A.destroyNode(L)},readlink(H){var I=A.lookupPath(H),J=I.node;if(!J)throw new A.ErrnoError(44);if(!J.node_ops.readlink)throw new A.ErrnoError(28);return v.resolve(A.getPath(J.parent),J.node_ops.readlink(J))},stat(H,I){var J=A.lookupPath(H,{follow:!I}),K=J.node;if(!K)throw new A.ErrnoError(44);if(!K.node_ops.getattr)throw new A.ErrnoError(63);return K.node_ops.getattr(K)},lstat(H){return A.stat(H,!0)},chmod(H,I,J){var K;if(typeof H=="string"){var L=A.lookupPath(H,{follow:!J});K=L.node}else K=H;if(!K.node_ops.setattr)throw new A.ErrnoError(63);K.node_ops.setattr(K,{mode:I&4095|K.mode&-4096,timestamp:Date.now()})},lchmod(H,I){A.chmod(H,I,!0)},fchmod(H,I){var J=A.getStreamChecked(H);A.chmod(J.node,I)},chown(H,I,J,K){var L;if(typeof H=="string"){var M=A.lookupPath(H,{follow:!K});L=M.node}else L=H;if(!L.node_ops.setattr)throw new A.ErrnoError(63);L.node_ops.setattr(L,{timestamp:Date.now()})},lchown(H,I,J){A.chown(H,I,J,!0)},fchown(H,I,J){var K=A.getStreamChecked(H);A.chown(K.node,I,J)},truncate(H,I){if(I<0)throw new A.ErrnoError(28);var J;if(typeof H=="string"){var K=A.lookupPath(H,{follow:!0});J=K.node}else J=H;if(!J.node_ops.setattr)throw new A.ErrnoError(63);if(A.isDir(J.mode))throw new A.ErrnoError(31);if(!A.isFile(J.mode))throw new A.ErrnoError(28);var L=A.nodePermissions(J,"w");if(L)throw new A.ErrnoError(L);J.node_ops.setattr(J,{size:I,timestamp:Date.now()})},ftruncate(H,I){var J=A.getStreamChecked(H);if(!(J.flags&2097155))throw new A.ErrnoError(28);A.truncate(J.node,I)},utime(H,I,J){var K=A.lookupPath(H,{follow:!0}),L=K.node;L.node_ops.setattr(L,{timestamp:Math.max(I,J)})},open(H,I,J){if(H==="")throw new A.ErrnoError(44);I=typeof I=="string"?ac(I):I,I&64?(J=J===void 0?438:J,J=J&4095|32768):J=0;var K;if(typeof H=="object")K=H;else{H=u.normalize(H);try{var L=A.lookupPath(H,{follow:!(I&131072)});K=L.node}catch{}}var M=!1;if(I&64)if(K){if(I&128)throw new A.ErrnoError(20)}else K=A.mknod(H,J,0),M=!0;if(!K)throw new A.ErrnoError(44);if(A.isChrdev(K.mode)&&(I&=-513),I&65536&&!A.isDir(K.mode))throw new A.ErrnoError(54);if(!M){var N=A.mayOpen(K,I);if(N)throw new A.ErrnoError(N)}I&512&&!M&&A.truncate(K,0),I&=-131713;var O=A.createStream({node:K,path:A.getPath(K),flags:I,seekable:!0,position:0,stream_ops:K.stream_ops,ungotten:[],error:!1});return O.stream_ops.open&&O.stream_ops.open(O),O},close(H){if(A.isClosed(H))throw new A.ErrnoError(8);H.getdents&&=null;try{H.stream_ops.close&&H.stream_ops.close(H)}catch(I){throw I}finally{A.closeStream(H.fd)}H.fd=null},isClosed(H){return H.fd===null},llseek(H,I,J){if(A.isClosed(H))throw new A.ErrnoError(8);if(!H.seekable||!H.stream_ops.llseek)throw new A.ErrnoError(70);if(J!=0&&J!=1&&J!=2)throw new A.ErrnoError(28);return H.position=H.stream_ops.llseek(H,I,J),H.ungotten=[],H.position},read(H,I,J,K,L){if(K<0||L<0)throw new A.ErrnoError(28);if(A.isClosed(H))throw new A.ErrnoError(8);if((H.flags&2097155)==1)throw new A.ErrnoError(8);if(A.isDir(H.node.mode))throw new A.ErrnoError(31);if(!H.stream_ops.read)throw new A.ErrnoError(28);var M=L!==void 0;if(!M)L=H.position;else if(!H.seekable)throw new A.ErrnoError(70);var N=H.stream_ops.read(H,I,J,K,L);return M||(H.position+=N),N},write(H,I,J,K,L,M){if(K<0||L<0)throw new A.ErrnoError(28);if(A.isClosed(H))throw new A.ErrnoError(8);if(!(H.flags&2097155))throw new A.ErrnoError(8);if(A.isDir(H.node.mode))throw new A.ErrnoError(31);if(!H.stream_ops.write)throw new A.ErrnoError(28);H.seekable&&H.flags&1024&&A.llseek(H,0,2);var N=L!==void 0;if(!N)L=H.position;else if(!H.seekable)throw new A.ErrnoError(70);var O=H.stream_ops.write(H,I,J,K,L,M);return N||(H.position+=O),O},allocate(H,I,J){if(A.isClosed(H))throw new A.ErrnoError(8);if(I<0||J<=0)throw new A.ErrnoError(28);if(!(H.flags&2097155))throw new A.ErrnoError(8);if(!A.isFile(H.node.mode)&&!A.isDir(H.node.mode))throw new A.ErrnoError(43);if(!H.stream_ops.allocate)throw new A.ErrnoError(138);H.stream_ops.allocate(H,I,J)},mmap(H,I,J,K,L){if(K&2&&!(L&2)&&(H.flags&2097155)!=2)throw new A.ErrnoError(2);if((H.flags&2097155)==1)throw new A.ErrnoError(2);if(!H.stream_ops.mmap)throw new A.ErrnoError(43);if(!I)throw new A.ErrnoError(28);return H.stream_ops.mmap(H,I,J,K,L)},msync(H,I,J,K,L){return H.stream_ops.msync?H.stream_ops.msync(H,I,J,K,L):0},ioctl(H,I,J){if(!H.stream_ops.ioctl)throw new A.ErrnoError(59);return H.stream_ops.ioctl(H,I,J)},readFile(H,I={}){if(I.flags=I.flags||0,I.encoding=I.encoding||"binary",I.encoding!=="utf8"&&I.encoding!=="binary")throw Error(`Invalid encoding type "${I.encoding}"`);var J,K=A.open(H,I.flags),L=A.stat(H),M=L.size,N=new Uint8Array(M);return A.read(K,N,0,M,0),I.encoding==="utf8"?J=w(N):I.encoding==="binary"&&(J=N),A.close(K),J},writeFile(H,I,J={}){J.flags=J.flags||577;var K=A.open(H,J.flags,J.mode);if(typeof I=="string"){var L=new Uint8Array(x(I)+1),M=Sb(I,L,0,L.length);A.write(K,L,0,M,void 0,J.canOwn)}else if(ArrayBuffer.isView(I))A.write(K,I,0,I.byteLength,void 0,J.canOwn);else throw Error("Unsupported data type");A.close(K)},cwd:()=>A.currentPath,chdir(H){var I=A.lookupPath(H,{follow:!0});if(I.node===null)throw new A.ErrnoError(44);if(!A.isDir(I.node.mode))throw new A.ErrnoError(54);var J=A.nodePermissions(I.node,"x");if(J)throw new A.ErrnoError(J);A.currentPath=I.path},createDefaultDirectories(){A.mkdir("/tmp"),A.mkdir("/home"),A.mkdir("/home/web_user")},createDefaultDevices(){A.mkdir("/dev"),A.registerDevice(A.makedev(1,3),{read:()=>0,write:(K,L,M,N,O)=>N}),A.mkdev("/dev/null",A.makedev(1,3)),y.register(A.makedev(5,0),y.default_tty_ops),y.register(A.makedev(6,0),y.default_tty1_ops),A.mkdev("/dev/tty",A.makedev(5,0)),A.mkdev("/dev/tty1",A.makedev(6,0));var H=new Uint8Array(1024),I=0,J=()=>(I===0&&(I=Pb(H).byteLength),H[--I]);A.createDevice("/dev","random",J),A.createDevice("/dev","urandom",J),A.mkdir("/dev/shm"),A.mkdir("/dev/shm/tmp")},createSpecialDirectories(){A.mkdir("/proc");var H=A.mkdir("/proc/self");A.mkdir("/proc/self/fd"),A.mount({mount(){var I=A.createNode(H,"fd",16895,73);return I.node_ops={lookup(J,K){var L=+K,M=A.getStreamChecked(L),N={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>M.path}};return N.parent=N,N}},I}},{},"/proc/self/fd")},createStandardStreams(H,I,J){H?A.createDevice("/dev","stdin",H):A.symlink("/dev/tty","/dev/stdin"),I?A.createDevice("/dev","stdout",null,I):A.symlink("/dev/tty","/dev/stdout"),J?A.createDevice("/dev","stderr",null,J):A.symlink("/dev/tty1","/dev/stderr");var K=A.open("/dev/stdin",0),L=A.open("/dev/stdout",1),M=A.open("/dev/stderr",1)},staticInit(){[44].forEach(H=>{A.genericErrors[H]=new A.ErrnoError(H),A.genericErrors[H].stack="<generic error, no stack>"}),A.nameTable=Array(4096),A.mount(z,{},"/"),A.createDefaultDirectories(),A.createDefaultDevices(),A.createSpecialDirectories(),A.filesystems={MEMFS:z}},init(H,I,J){A.initialized=!0,A.createStandardStreams(H,I,J)},quit(){A.initialized=!1;for(var H=0;H<A.streams.length;H++){var I=A.streams[H];if(!I)continue;A.close(I)}},findObject(H,I){var J=A.analyzePath(H,I);return J.exists?J.object:null},analyzePath(H,I){try{var J=A.lookupPath(H,{follow:!I});H=J.path}catch{}var K={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var J=A.lookupPath(H,{parent:!0});K.parentExists=!0,K.parentPath=J.path,K.parentObject=J.node,K.name=u.basename(H),J=A.lookupPath(H,{follow:!I}),K.exists=!0,K.path=J.path,K.object=J.node,K.name=J.node.name,K.isRoot=J.path==="/"}catch(L){K.error=L.errno}return K},createPath(H,I,J,K){H=typeof H=="string"?H:A.getPath(H);for(var L=I.split("/").reverse();L.length;){var M=L.pop();if(!M)continue;var N=u.join2(H,M);try{A.mkdir(N)}catch{}H=N}return N},createFile(H,I,J,K,L){var M=u.join2(typeof H=="string"?H:A.getPath(H),I),N=bc(K,L);return A.create(M,N)},createDataFile(H,I,J,K,L,M){var N=I;H&&(H=typeof H=="string"?H:A.getPath(H),N=I?u.join2(H,I):H);var O=bc(K,L),P=A.create(N,O);if(J){if(typeof J=="string"){for(var Q=Array(J.length),R=0,S=J.length;R<S;++R)Q[R]=J.charCodeAt(R);J=Q}A.chmod(P,O|146);var T=A.open(P,577);A.write(T,J,0,J.length,0,M),A.close(T),A.chmod(P,O)}},createDevice(H,I,J,K){var L=u.join2(typeof H=="string"?H:A.getPath(H),I),M=bc(!!J,!!K);A.createDevice.major??=64;var N=A.makedev(A.createDevice.major++,0);return A.registerDevice(N,{open(O){O.seekable=!1},close(O){K?.buffer?.length&&K(10)},read(O,P,Q,R,S){for(var T=0,U=0;U<R;U++){var V;try{V=J()}catch{throw new A.ErrnoError(29)}if(V===void 0&&T===0)throw new A.ErrnoError(6);if(V==null)break;T++,P[Q+U]=V}return T&&(O.node.timestamp=Date.now()),T},write(O,P,Q,R,S){for(var T=0;T<R;T++)try{K(P[Q+T])}catch{throw new A.ErrnoError(29)}return R&&(O.node.timestamp=Date.now()),T}}),A.mkdev(L,M,N)},forceLoadFile(H){if(H.isDevice||H.isFolder||H.link||H.contents)return!0;if(typeof XMLHttpRequest<"u")throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{H.contents=Wa(H.url),H.usedBytes=H.contents.length}catch{throw new A.ErrnoError(29)}},createLazyFile(H,I,J,K,L){class M{constructor(){this.lengthKnown=!1,this.chunks=[]}get(T){if(T>this.length-1||T<0)return;var U=T%this.chunkSize,V=T/this.chunkSize|0;return this.getter(V)[U]}setDataGetter(T){this.getter=T}cacheLength(){var T=new XMLHttpRequest;if(T.open("HEAD",J,!1),T.send(null),!(T.status>=200&&T.status<300||T.status===304))throw Error("Couldn't load "+J+". Status: "+T.status);var U=Number(T.getResponseHeader("Content-length")),V,W=(V=T.getResponseHeader("Accept-Ranges"))&&V==="bytes",X=(V=T.getResponseHeader("Content-Encoding"))&&V==="gzip",Y=1024*1024;W||(Y=U);var og=($,pg)=>{if($>pg)throw Error("invalid range ("+$+", "+pg+") or no bytes requested!");if(pg>U-1)throw Error("only "+U+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",J,!1),U!==Y&&_.setRequestHeader("Range","bytes="+$+"-"+pg),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw Error("Couldn't load "+J+". Status: "+_.status);return _.response===void 0?Tb(_.responseText||"",!0):new Uint8Array(_.response||[])},Z=this;Z.setDataGetter($=>{var pg=$*Y,_=($+1)*Y-1;if(_=Math.min(_,U-1),typeof Z.chunks[$]>"u"&&(Z.chunks[$]=og(pg,_)),typeof Z.chunks[$]>"u")throw Error("doXHR failed!");return Z.chunks[$]}),(X||!U)&&(Y=U=1,U=this.getter(0).length,Y=U,Za("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=U,this._chunkSize=Y,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!i)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var N=new M,O={isDevice:!1,contents:N}}else{var O={isDevice:!1,url:J}}var P=A.createFile(H,I,O,K,L);O.contents?P.contents=O.contents:O.url&&(P.contents=null,P.url=O.url),Object.defineProperties(P,{usedBytes:{get:function(){return this.contents.length}}});var Q={},R=Object.keys(P.stream_ops);R.forEach(T=>{var U=P.stream_ops[T];Q[T]=(...V)=>(A.forceLoadFile(P),U(...V))});function S(T,U,V,W,X){var Y=T.node.contents;if(X>=Y.length)return 0;var og=Math.min(Y.length-X,W);if(Y.slice)for(var Z=0;Z<og;Z++)U[V+Z]=Y[X+Z];else for(var Z=0;Z<og;Z++)U[V+Z]=Y.get(X+Z);return og}return Q.read=(T,U,V,W,X)=>(A.forceLoadFile(P),S(T,U,V,W,X)),Q.mmap=(T,U,V,W,X)=>{A.forceLoadFile(P);var Y=Wb(U);if(!Y)throw new A.ErrnoError(48);return S(T,o,Y,U,V),{ptr:Y,allocated:!0}},P.stream_ops=Q,P}},cc=(H,I)=>H?w(cb,H,I):"",B={DEFAULT_POLLMASK:5,calculateAt(H,I,J){if(u.isAbs(I))return I;var K;if(H===-100)K=A.cwd();else{var L=B.getStreamFromFD(H);K=L.path}if(I.length==0){if(!J)throw new A.ErrnoError(44);return K}return u.join2(K,I)},doStat(H,I,J){var K=H(I);q[J>>2]=K.dev,q[J+4>>2]=K.mode,r[J+8>>2]=K.nlink,q[J+12>>2]=K.uid,q[J+16>>2]=K.gid,q[J+20>>2]=K.rdev,s[J+24>>3]=BigInt(K.size),q[J+32>>2]=4096,q[J+36>>2]=K.blocks;var L=K.atime.getTime(),M=K.mtime.getTime(),N=K.ctime.getTime();return s[J+40>>3]=BigInt(Math.floor(L/1e3)),r[J+48>>2]=L%1e3*1e3*1e3,s[J+56>>3]=BigInt(Math.floor(M/1e3)),r[J+64>>2]=M%1e3*1e3*1e3,s[J+72>>3]=BigInt(Math.floor(N/1e3)),r[J+80>>2]=N%1e3*1e3*1e3,s[J+88>>3]=BigInt(K.ino),0},doMsync(H,I,J,K,L){if(!A.isFile(I.node.mode))throw new A.ErrnoError(43);if(K&2)return 0;var M=cb.slice(H,H+J);A.msync(I,M,L,J,K)},getStreamFromFD(H){var I=A.getStreamChecked(H);return I},varargs:void 0,getStr(H){var I=cc(H);return I}};function dc(H,I,J){try{var K=B.getStreamFromFD(H);if(K.fd===I)return-28;if(I<0||I>=A.MAX_OPEN_FDS)return-8;var L=A.getStream(I);return L&&A.close(L),A.dupStream(K,I).fd}catch(M){if(A===void 0||M.name!=="ErrnoError")throw M;return-M.errno}}function ec(){var H=q[+B.varargs>>2];return B.varargs+=4,H}var C=ec;function fc(H,I,J){B.varargs=J;try{var K=B.getStreamFromFD(H);switch(I){case 0:{var L=ec();if(L<0)return-28;for(;A.streams[L];)L++;var M;return M=A.dupStream(K,L),M.fd}case 1:case 2:return 0;case 3:return K.flags;case 4:{var L=ec();return K.flags|=L,0}case 12:{var L=C(),N=0;return p[L+N>>1]=2,0}case 13:case 14:return 0}return-28}catch(O){if(A===void 0||O.name!=="ErrnoError")throw O;return-O.errno}}function gc(H,I,J){B.varargs=J;try{var K=B.getStreamFromFD(H);switch(I){case 21509:return K.tty?0:-59;case 21505:{if(!K.tty)return-59;if(K.tty.ops.ioctl_tcgets){var L=K.tty.ops.ioctl_tcgets(K),M=C();q[M>>2]=L.c_iflag||0,q[M+4>>2]=L.c_oflag||0,q[M+8>>2]=L.c_cflag||0,q[M+12>>2]=L.c_lflag||0;for(var N=0;N<32;N++)o[M+N+17]=L.c_cc[N]||0;return 0}return 0}case 21510:case 21511:case 21512:return K.tty?0:-59;case 21506:case 21507:case 21508:{if(!K.tty)return-59;if(K.tty.ops.ioctl_tcsets){for(var M=C(),O=q[M>>2],P=q[M+4>>2],Q=q[M+8>>2],R=q[M+12>>2],S=[],N=0;N<32;N++)S.push(o[M+N+17]);return K.tty.ops.ioctl_tcsets(K.tty,I,{c_iflag:O,c_oflag:P,c_cflag:Q,c_lflag:R,c_cc:S})}return 0}case 21519:{if(!K.tty)return-59;var M=C();return q[M>>2]=0,0}case 21520:return K.tty?-28:-59;case 21531:{var M=C();return A.ioctl(K,I,M)}case 21523:{if(!K.tty)return-59;if(K.tty.ops.ioctl_tiocgwinsz){var T=K.tty.ops.ioctl_tiocgwinsz(K.tty),M=C();p[M>>1]=T[0],p[M+2>>1]=T[1]}return 0}case 21524:return K.tty?0:-59;case 21515:return K.tty?0:-59;default:return-28}}catch(U){if(A===void 0||U.name!=="ErrnoError")throw U;return-U.errno}}function hc(H,I,J,K){B.varargs=K;try{I=B.getStr(I),I=B.calculateAt(H,I);var L=K?ec():0;return A.open(I,J,L).fd}catch(M){if(A===void 0||M.name!=="ErrnoError")throw M;return-M.errno}}var D=(H,I,J)=>Sb(H,cb,I,J);function ic(H,I,J,K){try{if(I=B.getStr(I),I=B.calculateAt(H,I),K<=0)return-28;var L=A.readlink(I),M=Math.min(K,x(L)),N=o[J+M];return D(L,J,K+1),o[J+M]=N,M}catch(O){if(A===void 0||O.name!=="ErrnoError")throw O;return-O.errno}}function jc(H,I,J,K){try{return I=B.getStr(I),K=B.getStr(K),I=B.calculateAt(H,I),K=B.calculateAt(J,K),A.rename(I,K),0}catch(L){if(A===void 0||L.name!=="ErrnoError")throw L;return-L.errno}}function kc(H){try{return H=B.getStr(H),A.rmdir(H),0}catch(I){if(A===void 0||I.name!=="ErrnoError")throw I;return-I.errno}}function lc(H,I,J){try{return I=B.getStr(I),I=B.calculateAt(H,I),J===0?A.unlink(I):J===512?A.rmdir(I):t("Invalid flags passed to unlinkat"),0}catch(K){if(A===void 0||K.name!=="ErrnoError")throw K;return-K.errno}}var mc=()=>{t("")},nc=1,oc=()=>nc,pc=H=>{if(j){if(!H)return 1;var I=cc(H);if(!I.length)return 0;var J=k("child_process");var K=J.spawnSync(I,[],{shell:!0,stdio:"inherit"}),L=(N,O)=>N<<8|O;if(K.status===null){var M=N=>{switch(N){case"SIGHUP":return 1;case"SIGQUIT":return 3;case"SIGFPE":return 8;case"SIGKILL":return 9;case"SIGALRM":return 14;case"SIGTERM":return 15;default:return 2}};return L(0,M(K.signal))}return L(K.status,0)}return H?-52:0},qc=()=>{throw 1/0},rc=9007199254740992,sc=-9007199254740992,tc=H=>H<sc||H>rc?NaN:Number(H);function uc(H,I){H=tc(H);var J=new Date(H*1e3);q[I>>2]=J.getUTCSeconds(),q[I+4>>2]=J.getUTCMinutes(),q[I+8>>2]=J.getUTCHours(),q[I+12>>2]=J.getUTCDate(),q[I+16>>2]=J.getUTCMonth(),q[I+20>>2]=J.getUTCFullYear()-1900,q[I+24>>2]=J.getUTCDay();var K=Date.UTC(J.getUTCFullYear(),0,1,0,0,0,0),L=(J.getTime()-K)/(1e3*60*60*24)|0;q[I+28>>2]=L}var vc=H=>H%4==0&&(H%100!=0||H%400==0),wc=[0,31,60,91,121,152,182,213,244,274,305,335],xc=[0,31,59,90,120,151,181,212,243,273,304,334],yc=H=>{var I=vc(H.getFullYear()),J=I?wc:xc,K=J[H.getMonth()]+H.getDate()-1;return K};function zc(H,I){H=tc(H);var J=new Date(H*1e3);q[I>>2]=J.getSeconds(),q[I+4>>2]=J.getMinutes(),q[I+8>>2]=J.getHours(),q[I+12>>2]=J.getDate(),q[I+16>>2]=J.getMonth(),q[I+20>>2]=J.getFullYear()-1900,q[I+24>>2]=J.getDay();var K=yc(J)|0;q[I+28>>2]=K,q[I+36>>2]=-(J.getTimezoneOffset()*60);var L=new Date(J.getFullYear(),0,1),M=new Date(J.getFullYear(),6,1).getTimezoneOffset(),N=L.getTimezoneOffset(),O=(M!=N&&J.getTimezoneOffset()==Math.min(N,M))|0;q[I+32>>2]=O}var Ac=function(H){var I=(()=>{var J=new Date(q[H+20>>2]+1900,q[H+16>>2],q[H+12>>2],q[H+8>>2],q[H+4>>2],q[H>>2],0),K=q[H+32>>2],L=J.getTimezoneOffset(),M=new Date(J.getFullYear(),0,1),N=new Date(J.getFullYear(),6,1).getTimezoneOffset(),O=M.getTimezoneOffset(),P=Math.min(O,N);if(K<0)q[H+32>>2]=Number(N!=O&&P==L);else if(K>0!=(P==L)){var Q=Math.max(O,N),R=K>0?P:Q;J.setTime(J.getTime()+(R-L)*6e4)}q[H+24>>2]=J.getDay();var S=yc(J)|0;q[H+28>>2]=S,q[H>>2]=J.getSeconds(),q[H+4>>2]=J.getMinutes(),q[H+8>>2]=J.getHours(),q[H+12>>2]=J.getDate(),q[H+16>>2]=J.getMonth(),q[H+20>>2]=J.getYear();var T=J.getTime();return isNaN(T)?-1:T/1e3})();return BigInt(I)},Bc=(H,I,J,K)=>{var L=new Date().getFullYear(),M=new Date(L,0,1),N=new Date(L,6,1),O=M.getTimezoneOffset(),P=N.getTimezoneOffset(),Q=Math.max(O,P);r[H>>2]=Q*60,q[I>>2]=Number(O!=P);var R=U=>{var V=U>=0?"-":"+",W=Math.abs(U),X=(""+Math.floor(W/60)).padStart(2,"0"),Y=String(W%60).padStart(2,"0");return`UTC${V}${X}${Y}`},S=R(O),T=R(P);P<O?(D(S,J,17),D(T,K,17)):(D(S,K,17),D(T,J,17))},Cc=()=>Date.now(),Dc=()=>2147483648,Ec=H=>{var I=_a.buffer,J=(H-I.byteLength+65535)/65536|0;try{return _a.grow(J),hb(),1}catch{}},Fc=H=>{var I=cb.length;H>>>=0;var J=Dc();if(H>J)return!1;for(var K=1;K<=4;K*=2){var L=I*(1+.2/K);L=Math.min(L,H+100663296);var M=Math.min(J,Vb(Math.max(H,L),65536)),N=Ec(M);if(N)return!0}return!1},Gc={},Hc=()=>Sa||"./this.program",Ic=()=>{if(!Ic.strings){var H=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",I={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:H,_:Hc()};for(var J in Gc)Gc[J]===void 0?delete I[J]:I[J]=Gc[J];var K=[];for(var J in I)K.push(`${J}=${I[J]}`);Ic.strings=K}return Ic.strings},Jc=(H,I)=>{for(var J=0;J<H.length;++J)o[I++]=H.charCodeAt(J);o[I]=0},Kc=(H,I)=>{var J=0;return Ic().forEach((K,L)=>{var M=I+J;r[H+L*4>>2]=M,Jc(K,M),J+=K.length+1}),0},Lc=(H,I)=>{var J=Ic();r[H>>2]=J.length;var K=0;return J.forEach(L=>K+=L.length+1),r[I>>2]=K,0},Mc=()=>!0,Nc=H=>{bb=H,Mc()||(ab=!0),Ta(H,new Ib(H))},Oc=(H,I)=>{bb=H,Nc(H)},Pc=Oc;function Qc(H){try{var I=B.getStreamFromFD(H);return A.close(I),0}catch(J){if(A===void 0||J.name!=="ErrnoError")throw J;return J.errno}}var Rc=(H,I,J,K)=>{for(var L=0,M=0;M<J;M++){var N=r[I>>2],O=r[I+4>>2];I+=8;var P=A.read(H,o,N,O,K);if(P<0)return-1;if(L+=P,P<O)break;K!==void 0&&(K+=P)}return L};function Sc(H,I,J,K){try{var L=B.getStreamFromFD(H),M=Rc(L,I,J);return r[K>>2]=M,0}catch(N){if(A===void 0||N.name!=="ErrnoError")throw N;return N.errno}}function Tc(H,I,J,K){I=tc(I);try{if(isNaN(I))return 61;var L=B.getStreamFromFD(H);return A.llseek(L,I,J),s[K>>3]=BigInt(L.position),L.getdents&&I===0&&J===0&&(L.getdents=null),0}catch(M){if(A===void 0||M.name!=="ErrnoError")throw M;return M.errno}}var Uc=(H,I,J,K)=>{for(var L=0,M=0;M<J;M++){var N=r[I>>2],O=r[I+4>>2];I+=8;var P=A.write(H,o,N,O,K);if(P<0)return-1;if(L+=P,P<O)break;K!==void 0&&(K+=P)}return L};function Vc(H,I,J,K){try{var L=B.getStreamFromFD(H),M=Uc(L,I,J);return r[K>>2]=M,0}catch(N){if(A===void 0||N.name!=="ErrnoError")throw N;return N.errno}}var Wc=[],E,Xc=H=>{var I=Wc[H];return I||(H>=Wc.length&&(Wc.length=H+1),Wc[H]=I=E.get(H)),I},Yc=H=>{var I=d["_"+H];return I},Zc=(H,I)=>{o.set(H,I)},$c=H=>ig(H),_c=H=>{var I=x(H)+1,J=$c(I);return D(H,J,I),J},ad=(H,I,J,K,L)=>{var M={string:V=>{var W=0;return V!=null&&V!==0&&(W=_c(V)),W},array:V=>{var W=$c(V.length);return Zc(V,W),W}};function N(V){return I==="string"?cc(V):I==="boolean"?!!V:V}var O=Yc(H),P=[],Q=0;if(K)for(var R=0;R<K.length;R++){var S=M[J[R]];S?(Q===0&&(Q=Nb()),P[R]=S(K[R])):P[R]=K[R]}var T=O(...P);function U(V){return Q!==0&&Mb(Q),N(V)}return T=U(T),T},bd=(H,I)=>{H<128?I.push(H):I.push(H%128|128,H>>7)},cd=H=>{for(var I={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},J={parameters:[],results:H[0]=="v"?[]:[I[H[0]]]},K=1;K<H.length;++K)J.parameters.push(I[H[K]]);return J},dd=(H,I)=>{var J=H.slice(0,1),K=H.slice(1),L={i:127,p:127,j:126,f:125,d:124,e:111};I.push(96),bd(K.length,I);for(var M=0;M<K.length;++M)I.push(L[K[M]]);J=="v"?I.push(0):I.push(1,L[J])},ed=(H,I)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(cd(I),H);var J=[1];dd(I,J);var K=[0,97,115,109,1,0,0,0,1];bd(J.length,K),K.push(...J),K.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var L=new WebAssembly.Module(new Uint8Array(K)),M=new WebAssembly.Instance(L,{e:{f:H}}),N=M.exports.f;return N},fd=(H,I)=>{if(F)for(var J=H;J<H+I;J++){var K=Xc(J);K&&F.set(K,J)}},F,gd=H=>(F||(F=new WeakMap,fd(0,E.length)),F.get(H)||0),hd=[],id=()=>{if(hd.length)return hd.pop();try{E.grow(1)}catch(H){if(!(H instanceof RangeError))throw H;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return E.length-1},jd=(H,I)=>{E.set(H,I),Wc[H]=E.get(H)},kd=(H,I)=>{var J=gd(H);if(J)return J;var K=id();try{jd(K,H)}catch(M){if(!(M instanceof TypeError))throw M;var L=ed(H,I);jd(K,L)}return F.set(H,K),K},ld=H=>{F.delete(Xc(H)),jd(H,null),hd.push(H)},md=H=>{var I=x(H)+1,J=fg(I);return J&&D(H,J,I),J};A.createPreloadedFile=_b,A.staticInit();var nd={x:dc,b:fc,h:gc,e:hc,l:ic,n:jc,o:kc,f:lc,p:mc,i:oc,m:pc,j:qc,q:uc,r:zc,s:Ac,t:Bc,a:Cc,k:Fc,v:Kc,w:Lc,y:Pc,c:Qc,g:Sc,u:Tc,d:Vc,z:kg},G=Hb(),od=()=>(od=G.B)(),pd=d._lua_checkstack=(H,I)=>(pd=d._lua_checkstack=G.C)(H,I),qd=d._lua_xmove=(H,I,J)=>(qd=d._lua_xmove=G.D)(H,I,J),rd=d._lua_atpanic=(H,I)=>(rd=d._lua_atpanic=G.E)(H,I),sd=d._lua_version=H=>(sd=d._lua_version=G.F)(H),td=d._lua_absindex=(H,I)=>(td=d._lua_absindex=G.G)(H,I),ud=d._lua_gettop=H=>(ud=d._lua_gettop=G.H)(H),vd=d._lua_settop=(H,I)=>(vd=d._lua_settop=G.I)(H,I),wd=d._lua_closeslot=(H,I)=>(wd=d._lua_closeslot=G.J)(H,I),xd=d._lua_rotate=(H,I,J)=>(xd=d._lua_rotate=G.K)(H,I,J),yd=d._lua_copy=(H,I,J)=>(yd=d._lua_copy=G.L)(H,I,J),zd=d._lua_pushvalue=(H,I)=>(zd=d._lua_pushvalue=G.M)(H,I),Ad=d._lua_type=(H,I)=>(Ad=d._lua_type=G.N)(H,I),Bd=d._lua_typename=(H,I)=>(Bd=d._lua_typename=G.O)(H,I),Cd=d._lua_iscfunction=(H,I)=>(Cd=d._lua_iscfunction=G.P)(H,I),Dd=d._lua_isinteger=(H,I)=>(Dd=d._lua_isinteger=G.Q)(H,I),Ed=d._lua_isnumber=(H,I)=>(Ed=d._lua_isnumber=G.R)(H,I),Fd=d._lua_isstring=(H,I)=>(Fd=d._lua_isstring=G.S)(H,I),Gd=d._lua_isuserdata=(H,I)=>(Gd=d._lua_isuserdata=G.T)(H,I),Hd=d._lua_rawequal=(H,I,J)=>(Hd=d._lua_rawequal=G.U)(H,I,J),Id=d._lua_arith=(H,I)=>(Id=d._lua_arith=G.V)(H,I),Jd=d._lua_compare=(H,I,J,K)=>(Jd=d._lua_compare=G.W)(H,I,J,K),Kd=d._lua_stringtonumber=(H,I)=>(Kd=d._lua_stringtonumber=G.X)(H,I),Ld=d._lua_tonumberx=(H,I,J)=>(Ld=d._lua_tonumberx=G.Y)(H,I,J),Md=d._lua_tointegerx=(H,I,J)=>(Md=d._lua_tointegerx=G.Z)(H,I,J),Nd=d._lua_toboolean=(H,I)=>(Nd=d._lua_toboolean=G._)(H,I),Od=d._lua_tolstring=(H,I,J)=>(Od=d._lua_tolstring=G.$)(H,I,J),Pd=d._lua_rawlen=(H,I)=>(Pd=d._lua_rawlen=G.aa)(H,I),Qd=d._lua_tocfunction=(H,I)=>(Qd=d._lua_tocfunction=G.ba)(H,I),Rd=d._lua_touserdata=(H,I)=>(Rd=d._lua_touserdata=G.ca)(H,I),Sd=d._lua_tothread=(H,I)=>(Sd=d._lua_tothread=G.da)(H,I),Td=d._lua_topointer=(H,I)=>(Td=d._lua_topointer=G.ea)(H,I),Ud=d._lua_pushnil=H=>(Ud=d._lua_pushnil=G.fa)(H),Vd=d._lua_pushnumber=(H,I)=>(Vd=d._lua_pushnumber=G.ga)(H,I),Wd=d._lua_pushinteger=(H,I)=>(Wd=d._lua_pushinteger=G.ha)(H,I),Xd=d._lua_pushlstring=(H,I,J)=>(Xd=d._lua_pushlstring=G.ia)(H,I,J),Yd=d._lua_pushstring=(H,I)=>(Yd=d._lua_pushstring=G.ja)(H,I),Zd=d._lua_pushcclosure=(H,I,J)=>(Zd=d._lua_pushcclosure=G.ka)(H,I,J),$d=d._lua_pushboolean=(H,I)=>($d=d._lua_pushboolean=G.la)(H,I),_d=d._lua_pushlightuserdata=(H,I)=>(_d=d._lua_pushlightuserdata=G.ma)(H,I),ae=d._lua_pushthread=H=>(ae=d._lua_pushthread=G.na)(H),be=d._lua_getglobal=(H,I)=>(be=d._lua_getglobal=G.oa)(H,I),ce=d._lua_gettable=(H,I)=>(ce=d._lua_gettable=G.pa)(H,I),de=d._lua_getfield=(H,I,J)=>(de=d._lua_getfield=G.qa)(H,I,J),ee=d._lua_geti=(H,I,J)=>(ee=d._lua_geti=G.ra)(H,I,J),fe=d._lua_rawget=(H,I)=>(fe=d._lua_rawget=G.sa)(H,I),ge=d._lua_rawgeti=(H,I,J)=>(ge=d._lua_rawgeti=G.ta)(H,I,J),he=d._lua_rawgetp=(H,I,J)=>(he=d._lua_rawgetp=G.ua)(H,I,J),ie=d._lua_createtable=(H,I,J)=>(ie=d._lua_createtable=G.va)(H,I,J),je=d._lua_getmetatable=(H,I)=>(je=d._lua_getmetatable=G.wa)(H,I),ke=d._lua_getiuservalue=(H,I,J)=>(ke=d._lua_getiuservalue=G.xa)(H,I,J),le=d._lua_setglobal=(H,I)=>(le=d._lua_setglobal=G.ya)(H,I),me=d._lua_settable=(H,I)=>(me=d._lua_settable=G.za)(H,I),ne=d._lua_setfield=(H,I,J)=>(ne=d._lua_setfield=G.Aa)(H,I,J),oe=d._lua_seti=(H,I,J)=>(oe=d._lua_seti=G.Ba)(H,I,J),pe=d._lua_rawset=(H,I)=>(pe=d._lua_rawset=G.Ca)(H,I),qe=d._lua_rawsetp=(H,I,J)=>(qe=d._lua_rawsetp=G.Da)(H,I,J),re=d._lua_rawseti=(H,I,J)=>(re=d._lua_rawseti=G.Ea)(H,I,J),se=d._lua_setmetatable=(H,I)=>(se=d._lua_setmetatable=G.Fa)(H,I),te=d._lua_setiuservalue=(H,I,J)=>(te=d._lua_setiuservalue=G.Ga)(H,I,J),ue=d._lua_callk=(H,I,J,K,L)=>(ue=d._lua_callk=G.Ha)(H,I,J,K,L),ve=d._lua_pcallk=(H,I,J,K,L,M)=>(ve=d._lua_pcallk=G.Ia)(H,I,J,K,L,M),we=d._lua_load=(H,I,J,K,L)=>(we=d._lua_load=G.Ja)(H,I,J,K,L),xe=d._lua_dump=(H,I,J,K)=>(xe=d._lua_dump=G.Ka)(H,I,J,K),ye=d._lua_status=H=>(ye=d._lua_status=G.La)(H),ze=d._lua_error=H=>(ze=d._lua_error=G.Ma)(H),Ae=d._lua_next=(H,I)=>(Ae=d._lua_next=G.Na)(H,I),Be=d._lua_toclose=(H,I)=>(Be=d._lua_toclose=G.Oa)(H,I),Ce=d._lua_concat=(H,I)=>(Ce=d._lua_concat=G.Pa)(H,I),De=d._lua_len=(H,I)=>(De=d._lua_len=G.Qa)(H,I),Ee=d._lua_getallocf=(H,I)=>(Ee=d._lua_getallocf=G.Ra)(H,I),Fe=d._lua_setallocf=(H,I,J)=>(Fe=d._lua_setallocf=G.Sa)(H,I,J),Ge=d._lua_setwarnf=(H,I,J)=>(Ge=d._lua_setwarnf=G.Ta)(H,I,J),He=d._lua_warning=(H,I,J)=>(He=d._lua_warning=G.Ua)(H,I,J),Ie=d._lua_newuserdatauv=(H,I,J)=>(Ie=d._lua_newuserdatauv=G.Va)(H,I,J),Je=d._lua_getupvalue=(H,I,J)=>(Je=d._lua_getupvalue=G.Wa)(H,I,J),Ke=d._lua_setupvalue=(H,I,J)=>(Ke=d._lua_setupvalue=G.Xa)(H,I,J),Le=d._lua_upvalueid=(H,I,J)=>(Le=d._lua_upvalueid=G.Ya)(H,I,J),Me=d._lua_upvaluejoin=(H,I,J,K,L)=>(Me=d._lua_upvaluejoin=G.Za)(H,I,J,K,L),Ne=d._luaL_traceback=(H,I,J,K)=>(Ne=d._luaL_traceback=G.$a)(H,I,J,K),Oe=d._lua_getstack=(H,I,J)=>(Oe=d._lua_getstack=G.ab)(H,I,J),Pe=d._lua_getinfo=(H,I,J)=>(Pe=d._lua_getinfo=G.bb)(H,I,J),Qe=d._luaL_buffinit=(H,I)=>(Qe=d._luaL_buffinit=G.cb)(H,I),Re=d._luaL_addstring=(H,I)=>(Re=d._luaL_addstring=G.db)(H,I),Se=d._luaL_prepbuffsize=(H,I)=>(Se=d._luaL_prepbuffsize=G.eb)(H,I),Te=d._luaL_addvalue=H=>(Te=d._luaL_addvalue=G.fb)(H),Ue=d._luaL_pushresult=H=>(Ue=d._luaL_pushresult=G.gb)(H),Ve=d._luaL_argerror=(H,I,J)=>(Ve=d._luaL_argerror=G.hb)(H,I,J),We=d._luaL_typeerror=(H,I,J)=>(We=d._luaL_typeerror=G.ib)(H,I,J),Xe=d._luaL_getmetafield=(H,I,J)=>(Xe=d._luaL_getmetafield=G.jb)(H,I,J),Ye=d._luaL_where=(H,I)=>(Ye=d._luaL_where=G.kb)(H,I),Ze=d._luaL_fileresult=(H,I,J)=>(Ze=d._luaL_fileresult=G.lb)(H,I,J),$e=d._luaL_execresult=(H,I)=>($e=d._luaL_execresult=G.mb)(H,I),_e=d._luaL_newmetatable=(H,I)=>(_e=d._luaL_newmetatable=G.nb)(H,I),af=d._luaL_setmetatable=(H,I)=>(af=d._luaL_setmetatable=G.ob)(H,I),bf=d._luaL_testudata=(H,I,J)=>(bf=d._luaL_testudata=G.pb)(H,I,J),cf=d._luaL_checkudata=(H,I,J)=>(cf=d._luaL_checkudata=G.qb)(H,I,J),df=d._luaL_optlstring=(H,I,J,K)=>(df=d._luaL_optlstring=G.rb)(H,I,J,K),ef=d._luaL_checklstring=(H,I,J)=>(ef=d._luaL_checklstring=G.sb)(H,I,J),ff=d._luaL_checkstack=(H,I,J)=>(ff=d._luaL_checkstack=G.tb)(H,I,J),gf=d._luaL_checktype=(H,I,J)=>(gf=d._luaL_checktype=G.ub)(H,I,J),hf=d._luaL_checkany=(H,I)=>(hf=d._luaL_checkany=G.vb)(H,I),jf=d._luaL_checknumber=(H,I)=>(jf=d._luaL_checknumber=G.wb)(H,I),kf=d._luaL_optnumber=(H,I,J)=>(kf=d._luaL_optnumber=G.xb)(H,I,J),lf=d._luaL_checkinteger=(H,I)=>(lf=d._luaL_checkinteger=G.yb)(H,I),mf=d._luaL_optinteger=(H,I,J)=>(mf=d._luaL_optinteger=G.zb)(H,I,J),nf=d._luaL_setfuncs=(H,I,J)=>(nf=d._luaL_setfuncs=G.Ab)(H,I,J),pf=d._luaL_addlstring=(H,I,J)=>(pf=d._luaL_addlstring=G.Bb)(H,I,J),qf=d._luaL_pushresultsize=(H,I)=>(qf=d._luaL_pushresultsize=G.Cb)(H,I),rf=d._luaL_buffinitsize=(H,I,J)=>(rf=d._luaL_buffinitsize=G.Db)(H,I,J),sf=d._luaL_ref=(H,I)=>(sf=d._luaL_ref=G.Eb)(H,I),tf=d._luaL_unref=(H,I,J)=>(tf=d._luaL_unref=G.Fb)(H,I,J),uf=d._luaL_loadfilex=(H,I,J)=>(uf=d._luaL_loadfilex=G.Gb)(H,I,J),vf=d._luaL_loadbufferx=(H,I,J,K,L)=>(vf=d._luaL_loadbufferx=G.Hb)(H,I,J,K,L),wf=d._luaL_loadstring=(H,I)=>(wf=d._luaL_loadstring=G.Ib)(H,I),xf=d._luaL_callmeta=(H,I,J)=>(xf=d._luaL_callmeta=G.Jb)(H,I,J),yf=d._luaL_len=(H,I)=>(yf=d._luaL_len=G.Kb)(H,I),zf=d._luaL_tolstring=(H,I,J)=>(zf=d._luaL_tolstring=G.Lb)(H,I,J),Af=d._luaL_getsubtable=(H,I,J)=>(Af=d._luaL_getsubtable=G.Mb)(H,I,J),Bf=d._luaL_requiref=(H,I,J,K)=>(Bf=d._luaL_requiref=G.Nb)(H,I,J,K),Cf=d._luaL_addgsub=(H,I,J,K)=>(Cf=d._luaL_addgsub=G.Ob)(H,I,J,K),Df=d._luaL_gsub=(H,I,J,K)=>(Df=d._luaL_gsub=G.Pb)(H,I,J,K),Ef=d._luaL_newstate=()=>(Ef=d._luaL_newstate=G.Qb)(),Ff=d._lua_newstate=(H,I)=>(Ff=d._lua_newstate=G.Rb)(H,I),Gf=d._free=H=>(Gf=d._free=G.Sb)(H),Hf=d._realloc=(H,I)=>(Hf=d._realloc=G.Tb)(H,I),If=d._luaL_checkversion_=(H,I,J)=>(If=d._luaL_checkversion_=G.Ub)(H,I,J),Jf=d._luaopen_base=H=>(Jf=d._luaopen_base=G.Vb)(H),Kf=d._luaopen_coroutine=H=>(Kf=d._luaopen_coroutine=G.Wb)(H),Lf=d._lua_newthread=H=>(Lf=d._lua_newthread=G.Xb)(H),Mf=d._lua_yieldk=(H,I,J,K)=>(Mf=d._lua_yieldk=G.Yb)(H,I,J,K),Nf=d._lua_isyieldable=H=>(Nf=d._lua_isyieldable=G.Zb)(H),Of=d._lua_resume=(H,I,J,K)=>(Of=d._lua_resume=G._b)(H,I,J,K),Pf=d._luaopen_debug=H=>(Pf=d._luaopen_debug=G.$b)(H),Qf=d._lua_gethookmask=H=>(Qf=d._lua_gethookmask=G.ac)(H),Rf=d._lua_gethook=H=>(Rf=d._lua_gethook=G.bc)(H),Sf=d._lua_gethookcount=H=>(Sf=d._lua_gethookcount=G.cc)(H),Tf=d._lua_getlocal=(H,I,J)=>(Tf=d._lua_getlocal=G.dc)(H,I,J),Uf=d._lua_sethook=(H,I,J,K)=>(Uf=d._lua_sethook=G.ec)(H,I,J,K),Vf=d._lua_setlocal=(H,I,J)=>(Vf=d._lua_setlocal=G.fc)(H,I,J),Wf=d._lua_setcstacklimit=(H,I)=>(Wf=d._lua_setcstacklimit=G.gc)(H,I),Xf=d._luaL_openlibs=H=>(Xf=d._luaL_openlibs=G.hc)(H),Yf=d._luaopen_package=H=>(Yf=d._luaopen_package=G.ic)(H),Zf=d._luaopen_table=H=>(Zf=d._luaopen_table=G.jc)(H),$f=d._luaopen_io=H=>($f=d._luaopen_io=G.kc)(H),_f=d._luaopen_os=H=>(_f=d._luaopen_os=G.lc)(H),ag=d._luaopen_string=H=>(ag=d._luaopen_string=G.mc)(H),bg=d._luaopen_math=H=>(bg=d._luaopen_math=G.nc)(H),cg=d._luaopen_utf8=H=>(cg=d._luaopen_utf8=G.oc)(H),dg=d._lua_close=H=>(dg=d._lua_close=G.pc)(H),eg=d._lua_resetthread=H=>(eg=d._lua_resetthread=G.qc)(H),fg=d._malloc=H=>(fg=d._malloc=G.rc)(H),gg=(H,I)=>(gg=G.sc)(H,I),hg=H=>(hg=G.tc)(H),ig=H=>(ig=G.uc)(H),jg=()=>(jg=G.vc)();function kg(H,I,J){var K=Nb();try{Xc(H)(I,J)}catch(L){if(Mb(K),L!==L+0)throw L;gg(1,0)}}d.ENV=Gc,d.ccall=ad,d.addFunction=kd,d.removeFunction=ld,d.setValue=Lb,d.getValue=Kb,d.stringToUTF8=D,d.lengthBytesUTF8=x,d.stringToNewUTF8=md,d.FS=A;var lg,mg;tb=function H(){lg||ng(),lg||(tb=H)};function ng(){if(rb>0)return;if(!mg&&(mg=1,mb(),rb>0))return;function H(){if(lg)return;if(lg=1,d.calledRun=1,ab)return;nb(),e(d),ob()}H()}return ng(),c=g,c}})(),glue_default=initWasmModule,LuaWasm=class a{static async initialize(b,c){const d=await glue_default({locateFile:(e,f)=>b||f+e,preRun:e=>{typeof c=="object"&&Object.entries(c).forEach(([f,g])=>e.ENV[f]=g)}});return new a(d)}module;luaL_checkversion_;luaL_getmetafield;luaL_callmeta;luaL_tolstring;luaL_argerror;luaL_typeerror;luaL_checklstring;luaL_optlstring;luaL_checknumber;luaL_optnumber;luaL_checkinteger;luaL_optinteger;luaL_checkstack;luaL_checktype;luaL_checkany;luaL_newmetatable;luaL_setmetatable;luaL_testudata;luaL_checkudata;luaL_where;luaL_fileresult;luaL_execresult;luaL_ref;luaL_unref;luaL_loadfilex;luaL_loadbufferx;luaL_loadstring;luaL_newstate;luaL_len;luaL_addgsub;luaL_gsub;luaL_setfuncs;luaL_getsubtable;luaL_traceback;luaL_requiref;luaL_buffinit;luaL_prepbuffsize;luaL_addlstring;luaL_addstring;luaL_addvalue;luaL_pushresult;luaL_pushresultsize;luaL_buffinitsize;lua_newstate;lua_close;lua_newthread;lua_resetthread;lua_atpanic;lua_version;lua_absindex;lua_gettop;lua_settop;lua_pushvalue;lua_rotate;lua_copy;lua_checkstack;lua_xmove;lua_isnumber;lua_isstring;lua_iscfunction;lua_isinteger;lua_isuserdata;lua_type;lua_typename;lua_tonumberx;lua_tointegerx;lua_toboolean;lua_tolstring;lua_rawlen;lua_tocfunction;lua_touserdata;lua_tothread;lua_topointer;lua_arith;lua_rawequal;lua_compare;lua_pushnil;lua_pushnumber;lua_pushinteger;lua_pushlstring;lua_pushstring;lua_pushcclosure;lua_pushboolean;lua_pushlightuserdata;lua_pushthread;lua_getglobal;lua_gettable;lua_getfield;lua_geti;lua_rawget;lua_rawgeti;lua_rawgetp;lua_createtable;lua_newuserdatauv;lua_getmetatable;lua_getiuservalue;lua_setglobal;lua_settable;lua_setfield;lua_seti;lua_rawset;lua_rawseti;lua_rawsetp;lua_setmetatable;lua_setiuservalue;lua_callk;lua_pcallk;lua_load;lua_dump;lua_yieldk;lua_resume;lua_status;lua_isyieldable;lua_setwarnf;lua_warning;lua_error;lua_next;lua_concat;lua_len;lua_stringtonumber;lua_getallocf;lua_setallocf;lua_toclose;lua_closeslot;lua_getstack;lua_getinfo;lua_getlocal;lua_setlocal;lua_getupvalue;lua_setupvalue;lua_upvalueid;lua_upvaluejoin;lua_sethook;lua_gethook;lua_gethookmask;lua_gethookcount;lua_setcstacklimit;luaopen_base;luaopen_coroutine;luaopen_table;luaopen_io;luaopen_os;luaopen_string;luaopen_utf8;luaopen_math;luaopen_debug;luaopen_package;luaL_openlibs;referenceTracker=new WeakMap;referenceMap=new Map;availableReferences=[];lastRefIndex;constructor(b){this.module=b,this.luaL_checkversion_=this.cwrap("luaL_checkversion_",null,["number","number","number"]),this.luaL_getmetafield=this.cwrap("luaL_getmetafield","number",["number","number","string"]),this.luaL_callmeta=this.cwrap("luaL_callmeta","number",["number","number","string"]),this.luaL_tolstring=this.cwrap("luaL_tolstring","string",["number","number","number"]),this.luaL_argerror=this.cwrap("luaL_argerror","number",["number","number","string"]),this.luaL_typeerror=this.cwrap("luaL_typeerror","number",["number","number","string"]),this.luaL_checklstring=this.cwrap("luaL_checklstring","string",["number","number","number"]),this.luaL_optlstring=this.cwrap("luaL_optlstring","string",["number","number","string","number"]),this.luaL_checknumber=this.cwrap("luaL_checknumber","number",["number","number"]),this.luaL_optnumber=this.cwrap("luaL_optnumber","number",["number","number","number"]),this.luaL_checkinteger=this.cwrap("luaL_checkinteger","number",["number","number"]),this.luaL_optinteger=this.cwrap("luaL_optinteger","number",["number","number","number"]),this.luaL_checkstack=this.cwrap("luaL_checkstack",null,["number","number","string"]),this.luaL_checktype=this.cwrap("luaL_checktype",null,["number","number","number"]),this.luaL_checkany=this.cwrap("luaL_checkany",null,["number","number"]),this.luaL_newmetatable=this.cwrap("luaL_newmetatable","number",["number","string"]),this.luaL_setmetatable=this.cwrap("luaL_setmetatable",null,["number","string"]),this.luaL_testudata=this.cwrap("luaL_testudata","number",["number","number","string"]),this.luaL_checkudata=this.cwrap("luaL_checkudata","number",["number","number","string"]),this.luaL_where=this.cwrap("luaL_where",null,["number","number"]),this.luaL_fileresult=this.cwrap("luaL_fileresult","number",["number","number","string"]),this.luaL_execresult=this.cwrap("luaL_execresult","number",["number","number"]),this.luaL_ref=this.cwrap("luaL_ref","number",["number","number"]),this.luaL_unref=this.cwrap("luaL_unref",null,["number","number","number"]),this.luaL_loadfilex=this.cwrap("luaL_loadfilex","number",["number","string","string"]),this.luaL_loadbufferx=this.cwrap("luaL_loadbufferx","number",["number","string|number","number","string|number","string"]),this.luaL_loadstring=this.cwrap("luaL_loadstring","number",["number","string"]),this.luaL_newstate=this.cwrap("luaL_newstate","number",[]),this.luaL_len=this.cwrap("luaL_len","number",["number","number"]),this.luaL_addgsub=this.cwrap("luaL_addgsub",null,["number","string","string","string"]),this.luaL_gsub=this.cwrap("luaL_gsub","string",["number","string","string","string"]),this.luaL_setfuncs=this.cwrap("luaL_setfuncs",null,["number","number","number"]),this.luaL_getsubtable=this.cwrap("luaL_getsubtable","number",["number","number","string"]),this.luaL_traceback=this.cwrap("luaL_traceback",null,["number","number","string","number"]),this.luaL_requiref=this.cwrap("luaL_requiref",null,["number","string","number","number"]),this.luaL_buffinit=this.cwrap("luaL_buffinit",null,["number","number"]),this.luaL_prepbuffsize=this.cwrap("luaL_prepbuffsize","string",["number","number"]),this.luaL_addlstring=this.cwrap("luaL_addlstring",null,["number","string","number"]),this.luaL_addstring=this.cwrap("luaL_addstring",null,["number","string"]),this.luaL_addvalue=this.cwrap("luaL_addvalue",null,["number"]),this.luaL_pushresult=this.cwrap("luaL_pushresult",null,["number"]),this.luaL_pushresultsize=this.cwrap("luaL_pushresultsize",null,["number","number"]),this.luaL_buffinitsize=this.cwrap("luaL_buffinitsize","string",["number","number","number"]),this.lua_newstate=this.cwrap("lua_newstate","number",["number","number"]),this.lua_close=this.cwrap("lua_close",null,["number"]),this.lua_newthread=this.cwrap("lua_newthread","number",["number"]),this.lua_resetthread=this.cwrap("lua_resetthread","number",["number"]),this.lua_atpanic=this.cwrap("lua_atpanic","number",["number","number"]),this.lua_version=this.cwrap("lua_version","number",["number"]),this.lua_absindex=this.cwrap("lua_absindex","number",["number","number"]),this.lua_gettop=this.cwrap("lua_gettop","number",["number"]),this.lua_settop=this.cwrap("lua_settop",null,["number","number"]),this.lua_pushvalue=this.cwrap("lua_pushvalue",null,["number","number"]),this.lua_rotate=this.cwrap("lua_rotate",null,["number","number","number"]),this.lua_copy=this.cwrap("lua_copy",null,["number","number","number"]),this.lua_checkstack=this.cwrap("lua_checkstack","number",["number","number"]),this.lua_xmove=this.cwrap("lua_xmove",null,["number","number","number"]),this.lua_isnumber=this.cwrap("lua_isnumber","number",["number","number"]),this.lua_isstring=this.cwrap("lua_isstring","number",["number","number"]),this.lua_iscfunction=this.cwrap("lua_iscfunction","number",["number","number"]),this.lua_isinteger=this.cwrap("lua_isinteger","number",["number","number"]),this.lua_isuserdata=this.cwrap("lua_isuserdata","number",["number","number"]),this.lua_type=this.cwrap("lua_type","number",["number","number"]),this.lua_typename=this.cwrap("lua_typename","string",["number","number"]),this.lua_tonumberx=this.cwrap("lua_tonumberx","number",["number","number","number"]),this.lua_tointegerx=this.cwrap("lua_tointegerx","number",["number","number","number"]),this.lua_toboolean=this.cwrap("lua_toboolean","number",["number","number"]),this.lua_tolstring=this.cwrap("lua_tolstring","string",["number","number","number"]),this.lua_rawlen=this.cwrap("lua_rawlen","number",["number","number"]),this.lua_tocfunction=this.cwrap("lua_tocfunction","number",["number","number"]),this.lua_touserdata=this.cwrap("lua_touserdata","number",["number","number"]),this.lua_tothread=this.cwrap("lua_tothread","number",["number","number"]),this.lua_topointer=this.cwrap("lua_topointer","number",["number","number"]),this.lua_arith=this.cwrap("lua_arith",null,["number","number"]),this.lua_rawequal=this.cwrap("lua_rawequal","number",["number","number","number"]),this.lua_compare=this.cwrap("lua_compare","number",["number","number","number","number"]),this.lua_pushnil=this.cwrap("lua_pushnil",null,["number"]),this.lua_pushnumber=this.cwrap("lua_pushnumber",null,["number","number"]),this.lua_pushinteger=this.cwrap("lua_pushinteger",null,["number","number"]),this.lua_pushlstring=this.cwrap("lua_pushlstring","string",["number","string|number","number"]),this.lua_pushstring=this.cwrap("lua_pushstring","string",["number","string|number"]),this.lua_pushcclosure=this.cwrap("lua_pushcclosure",null,["number","number","number"]),this.lua_pushboolean=this.cwrap("lua_pushboolean",null,["number","number"]),this.lua_pushlightuserdata=this.cwrap("lua_pushlightuserdata",null,["number","number"]),this.lua_pushthread=this.cwrap("lua_pushthread","number",["number"]),this.lua_getglobal=this.cwrap("lua_getglobal","number",["number","string"]),this.lua_gettable=this.cwrap("lua_gettable","number",["number","number"]),this.lua_getfield=this.cwrap("lua_getfield","number",["number","number","string"]),this.lua_geti=this.cwrap("lua_geti","number",["number","number","number"]),this.lua_rawget=this.cwrap("lua_rawget","number",["number","number"]),this.lua_rawgeti=this.cwrap("lua_rawgeti","number",["number","number","number"]),this.lua_rawgetp=this.cwrap("lua_rawgetp","number",["number","number","number"]),this.lua_createtable=this.cwrap("lua_createtable",null,["number","number","number"]),this.lua_newuserdatauv=this.cwrap("lua_newuserdatauv","number",["number","number","number"]),this.lua_getmetatable=this.cwrap("lua_getmetatable","number",["number","number"]),this.lua_getiuservalue=this.cwrap("lua_getiuservalue","number",["number","number","number"]),this.lua_setglobal=this.cwrap("lua_setglobal",null,["number","string"]),this.lua_settable=this.cwrap("lua_settable",null,["number","number"]),this.lua_setfield=this.cwrap("lua_setfield",null,["number","number","string"]),this.lua_seti=this.cwrap("lua_seti",null,["number","number","number"]),this.lua_rawset=this.cwrap("lua_rawset",null,["number","number"]),this.lua_rawseti=this.cwrap("lua_rawseti",null,["number","number","number"]),this.lua_rawsetp=this.cwrap("lua_rawsetp",null,["number","number","number"]),this.lua_setmetatable=this.cwrap("lua_setmetatable","number",["number","number"]),this.lua_setiuservalue=this.cwrap("lua_setiuservalue","number",["number","number","number"]),this.lua_callk=this.cwrap("lua_callk",null,["number","number","number","number","number"]),this.lua_pcallk=this.cwrap("lua_pcallk","number",["number","number","number","number","number","number"]),this.lua_load=this.cwrap("lua_load","number",["number","number","number","string","string"]),this.lua_dump=this.cwrap("lua_dump","number",["number","number","number","number"]),this.lua_yieldk=this.cwrap("lua_yieldk","number",["number","number","number","number"]),this.lua_resume=this.cwrap("lua_resume","number",["number","number","number","number"]),this.lua_status=this.cwrap("lua_status","number",["number"]),this.lua_isyieldable=this.cwrap("lua_isyieldable","number",["number"]),this.lua_setwarnf=this.cwrap("lua_setwarnf",null,["number","number","number"]),this.lua_warning=this.cwrap("lua_warning",null,["number","string","number"]),this.lua_error=this.cwrap("lua_error","number",["number"]),this.lua_next=this.cwrap("lua_next","number",["number","number"]),this.lua_concat=this.cwrap("lua_concat",null,["number","number"]),this.lua_len=this.cwrap("lua_len",null,["number","number"]),this.lua_stringtonumber=this.cwrap("lua_stringtonumber","number",["number","string"]),this.lua_getallocf=this.cwrap("lua_getallocf","number",["number","number"]),this.lua_setallocf=this.cwrap("lua_setallocf",null,["number","number","number"]),this.lua_toclose=this.cwrap("lua_toclose",null,["number","number"]),this.lua_closeslot=this.cwrap("lua_closeslot",null,["number","number"]),this.lua_getstack=this.cwrap("lua_getstack","number",["number","number","number"]),this.lua_getinfo=this.cwrap("lua_getinfo","number",["number","string","number"]),this.lua_getlocal=this.cwrap("lua_getlocal","string",["number","number","number"]),this.lua_setlocal=this.cwrap("lua_setlocal","string",["number","number","number"]),this.lua_getupvalue=this.cwrap("lua_getupvalue","string",["number","number","number"]),this.lua_setupvalue=this.cwrap("lua_setupvalue","string",["number","number","number"]),this.lua_upvalueid=this.cwrap("lua_upvalueid","number",["number","number","number"]),this.lua_upvaluejoin=this.cwrap("lua_upvaluejoin",null,["number","number","number","number","number"]),this.lua_sethook=this.cwrap("lua_sethook",null,["number","number","number","number"]),this.lua_gethook=this.cwrap("lua_gethook","number",["number"]),this.lua_gethookmask=this.cwrap("lua_gethookmask","number",["number"]),this.lua_gethookcount=this.cwrap("lua_gethookcount","number",["number"]),this.lua_setcstacklimit=this.cwrap("lua_setcstacklimit","number",["number","number"]),this.luaopen_base=this.cwrap("luaopen_base","number",["number"]),this.luaopen_coroutine=this.cwrap("luaopen_coroutine","number",["number"]),this.luaopen_table=this.cwrap("luaopen_table","number",["number"]),this.luaopen_io=this.cwrap("luaopen_io","number",["number"]),this.luaopen_os=this.cwrap("luaopen_os","number",["number"]),this.luaopen_string=this.cwrap("luaopen_string","number",["number"]),this.luaopen_utf8=this.cwrap("luaopen_utf8","number",["number"]),this.luaopen_math=this.cwrap("luaopen_math","number",["number"]),this.luaopen_debug=this.cwrap("luaopen_debug","number",["number"]),this.luaopen_package=this.cwrap("luaopen_package","number",["number"]),this.luaL_openlibs=this.cwrap("luaL_openlibs",null,["number"])}lua_remove(b,c){this.lua_rotate(b,c,-1),this.lua_pop(b,1)}lua_pop(b,c){this.lua_settop(b,-c-1)}luaL_getmetatable(b,c){return this.lua_getfield(b,LUA_REGISTRYINDEX,c)}lua_yield(b,c){return this.lua_yieldk(b,c,0,null)}lua_upvalueindex(b){return LUA_REGISTRYINDEX-b}ref(b){const c=this.referenceTracker.get(b);if(c)return c.refCount++,c.index;const d=this.availableReferences.pop(),e=d===void 0?this.referenceMap.size+1:d;return this.referenceMap.set(e,b),this.referenceTracker.set(b,{refCount:1,index:e}),this.lastRefIndex=e,e}unref(b){const c=this.referenceMap.get(b);if(c===void 0)return;const d=this.referenceTracker.get(c);if(d===void 0){this.referenceTracker.delete(c),this.availableReferences.push(b);return}d.refCount--,d.refCount<=0&&(this.referenceTracker.delete(c),this.referenceMap.delete(b),this.availableReferences.push(b))}getRef(b){return this.referenceMap.get(b)}getLastRefIndex(){return this.lastRefIndex}printRefs(){for(const[b,c]of this.referenceMap.entries())console.log(b,c)}cwrap(b,c,d){const e=d.some(f=>f==="string|number");return e?(...f)=>{const g=[],h=d.map((i,j)=>{if(i==="string|number"){if(typeof f[j]=="number")return"number";if(f[j]?.length>1024){const k=this.module.stringToNewUTF8(f[j]);return f[j]=k,g.push(k),"number"}return"string"}return i});try{return this.module.ccall(b,c,h,f)}finally{for(const i of g)this.module._free(i)}}:(...f)=>this.module.ccall(b,c,d,f)}},LuaFactory=class{luaWasmPromise;constructor(a,b){if(a===void 0){const c=typeof window=="object"&&typeof window.document<"u"||typeof self=="object"&&self?.constructor?.name==="DedicatedWorkerGlobalScope";c&&(a=`objlua.wasm`)}this.luaWasmPromise=LuaWasm.initialize(a,b)}async mountFile(a,b){this.mountFileSync(await this.getLuaModule(),a,b)}mountFileSync(a,b,c){const d=b.lastIndexOf("/"),e=b.substring(d+1),f=b.substring(0,b.length-e.length-1);if(f.length>0){const g=f.split("/").reverse();let h="";for(;g.length;){const i=g.pop();if(!i)continue;const j=`${h}/${i}`;try{a.module.FS.mkdir(j)}catch{}h=j}}a.module.FS.writeFile(b,c)}async createEngine(a={}){return new LuaEngine(await this.getLuaModule(),a)}async getLuaModule(){return this.luaWasmPromise}};export{Decoration,LUAI_MAXSTACK,LUA_MULTRET,LUA_REGISTRYINDEX,LuaEngine,LuaEventCodes,LuaEventMasks,LuaFactory,Global as LuaGlobal,LuaLibraries,MultiReturn as LuaMultiReturn,RawResult as LuaRawResult,LuaReturn,Thread as LuaThread,LuaTimeoutError,LuaType,LuaTypeExtension,LuaWasm,PointerSize,decorate,decorateFunction,decorateProxy,decorateUserdata};
//# sourceMappingURL=index.js.map